{"version":3,"sources":["js/lib/html2canvas.js"],"names":["window","document","undefined","h2clog","a","_html2canvas","logging","console","log","backgroundBoundsFactory","prop","el","bounds","image","imageIndex","backgroundSize","topPos","left","percentage","val","bgposition","Util","getCSS","length","toString","indexOf","parseFloat","width","match","resized","resizeBounds","height","parseInt","h2cRenderContext","storage","clip","push","type","name","arguments","translate","fill","save","restore","fillRect","createPattern","drawShape","shape","moveTo","lineTo","arcTo","bezierCurveTo","quadraticCurveTo","drawImage","fillText","setVariable","variable","value","h2czContext","zindex","children","computedCSS","trimText","isNative","input","apply","replace","String","prototype","trim","parseBackgroundImage","method","definition","prefix","prefix_i","block","c","quote","args","whitespace","results","mode","numParen","appendResult","substr","toLowerCase","i","ii","Bounds","clientRect","getBoundingClientRect","top","bottom","right","attribute","index","toPX","rsLeft","runtimeStyle","style","test","currentStyle","pixelLeft","Math","round","isBackgroundSizePosition","previousElement","defaultView","getComputedStyle","split","arr","current_width","current_height","target_width","target_height","stretch_mode","output_width","output_height","target_ratio","current_ratio","BackgroundPosition","result","BackgroundSize","Extend","options","defaults","key","hasOwnProperty","Children","elem","nodeName","toUpperCase","contentDocument","contentWindow","array","ret","first","second","j","l","childNodes","ex","message","Font","fontData","font","fontSize","doc","baseline","middle","metricsObj","container","createElement","img","span","visibility","fontFamily","margin","padding","body","appendChild","src","verticalAlign","createTextNode","offsetTop","removeChild","lineHeight","lineWidth","Generate","reGradients","parseGradient","css","gradient","m1","stop","m2","m2Len","step","m3","tl","tr","br","bl","len","x0","y0","x1","y1","colorStops","max","color","cx","cy","rx","ry","sqrt","pow","min","Gradient","grad","canvas","ctx","getContext","createLinearGradient","addColorStop","e","fillStyle","createRadialGradient","canvasRadial","ctxRadial","ri","di","ListAlpha","number","modulus","tmp","fromCharCode","ListRoman","v","romanArray","decimal","roman","Parse","images","documentWidth","scrollWidth","documentElement","offsetWidth","clientWidth","documentHeight","scrollHeight","offsetHeight","clientHeight","getCSSInt","element","isNaN","renderRect","x","y","w","h","bgcolor","numDraws","textTransform","text","transform","m","p1","p2","noLetterSpacing","letter_spacing","drawText","currentText","setTextVariables","text_decoration","bold","family","size","join","renderTextDecoration","metrics","ceil","getTextBounds","state","textDecoration","isLast","support","rangeBounds","textRangeBounds","node","textOffset","nodeValue","newTextNode","splitText","textWrapperBounds","textNode","range","createRange","setStart","setEnd","oldTextNode","parent","parentNode","wrapElement","backupText","cloneNode","replaceChild","renderText","stack","textList","textAlign","letterRendering","chinese","forEach","word","unshift","splice","listPosition","originalType","boundElement","display","listStyleType","insertBefore","firstChild","elementIndex","count","childs","nodeType","listItemText","currentIndex","renderListItem","elBounds","listBounds","loadImage","succeeded","clipBounds","dst","setZ","zIndex","parentZ","newContext","renderImage","borders","paddingLeft","paddingTop","paddingRight","paddingBottom","getBorderData","map","side","getBorderRadiusData","bezierCurve","start","startControl","endControl","end","lerp","b","t","subdivide","ab","bc","cd","abbc","bccd","dest","curveTo","borderArgs","curveToReversed","parseCorner","radius1","radius2","corner1","corner2","drawSide","borderData","outer1","inner1","outer2","inner2","c1","c2","c3","c4","calculateCurvePoints","borderRadius","tlh","tlv","trh","trv","brv","brh","blh","blv","topWidth","rightHeight","bottomWidth","leftHeight","topLeftOuter","getCurvePoints","topLeft","topLeftInner","topRightOuter","topRight","topRightInner","bottomRightOuter","bottomRight","bottomRightInner","bottomLeftOuter","bottomLeft","bottomLeftInner","getBorderClip","borderPoints","radius","backgroundClip","parseBorders","borderSide","bx","by","bw","bh","createShape","border","slice","renderBorders","renderFormValue","textValue","valueWrap","cssPropertyArray","property","borderColor","borderStyle","position","selectedIndex","placeholder","Array","call","getPseudoElement","which","elStyle","content","isImage","elps","className","pseudoHide","Object","keys","filter","indexedProperty","innerHTML","injectPseudoElements","before","after","parseElement","renderBackgroundRepeat","backgroundPosition","offsetX","offsetY","backgroundRepeatShape","renderBackgroundColor","backgroundBounds","renderBackgroundRepeating","backgroundRepeat","resizeImage","renderBackgroundImage","backgroundImage","backgroundImages","setOpacity","parentStack","opacity","createStack","cssPosition","useOverflow","getBackgroundBounds","renderElement","pseudoElement","ignoreElementsRegExp","getAttribute","isElementVisible","hasAttribute","svgDOMRender","parseDOM","attr","alen","elm","html","hasAttributes","attributes","Image","docWidth","docHeight","onload","svgRender","scroll","elements","ownerDocument","Support","RegExp","ignoreElements","hidePseudoElements","kappa","r1","r2","ox","oy","xm","ym","svgRendering","childElement","backgroundColor","Preload","isSameOrigin","url","link","href","protocol","host","pageOrigin","numLoaded","numTotal","numFailed","firstRun","complete","proxyGetImage","imageObj","callback_name","script","scriptUrl","proxy","callbackname","encodeURIComponent","substring","setImageLoadHandlers","setAttribute","loadPseudoElement","methods","loadBackgroundImages","loadPseudoElementImages","loadGradientImage","invalidBackgrounds","background_image","getImages","elNodeType","timer","clearTimeout","onerror","crossOrigin","timeoutTimer","cleanupDone","domImages","imgLen","supportCORS","location","allowTaint","useCORS","customComplete","this","setTimeout","bind","cleanupDOM","cause","timeout","execCommand","close","renderingDone","Renderer","parseQueue","rendererName","renderer","Error","queue","sortZ","zStack","subStacks","stackValues","stackChild","sort","zValue","some","r","testElement","rangeHeight","selectNode","toDataURL","html2canvas","opts","background","taintTest","onpreloaded","onparsed","onrendered","render","parse","preload","Canvas","beginPath","arg","closePath","safeImage","item","safeImages","testctx","getImageData","testCanvas","isTransparent","renderItem","storageContext","queueLen","newCanvas","fstyle","canvasPosition","textBaseline","rect"],"mappings":"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","file":"html2canvas.min.js","sourcesContent":["/*\r\n  html2canvas 0.4.0 <http://html2canvas.hertzen.com>\r\n  Copyright (c) 2013 Niklas von Hertzen (@niklasvh)\r\n\r\n  Released under MIT License\r\n*/\r\n(function(window, document, undefined){\r\n\r\n\"use strict\";\r\n\r\nvar _html2canvas = {},\r\npreviousElement,\r\ncomputedCSS,\r\nhtml2canvas;\r\n\r\nfunction h2clog(a) {\r\n  if (_html2canvas.logging && window.console && window.console.log) {\r\n    window.console.log(a);\r\n  }\r\n}\r\n\r\n_html2canvas.Util = {};\r\n\r\n_html2canvas.Util.trimText = (function(isNative){\r\n  return function(input){\r\n    if(isNative) { return isNative.apply( input ); }\r\n    else { return ((input || '') + '').replace( /^\\s+|\\s+$/g , '' ); }\r\n  };\r\n})( String.prototype.trim );\r\n\r\n_html2canvas.Util.parseBackgroundImage = function (value) {\r\n    var whitespace = ' \\r\\n\\t',\r\n        method, definition, prefix, prefix_i, block, results = [],\r\n        c, mode = 0, numParen = 0, quote, args;\r\n\r\n    var appendResult = function(){\r\n        if(method) {\r\n            if(definition.substr( 0, 1 ) === '\"') {\r\n                definition = definition.substr( 1, definition.length - 2 );\r\n            }\r\n            if(definition) {\r\n                args.push(definition);\r\n            }\r\n            if(method.substr( 0, 1 ) === '-' &&\r\n                    (prefix_i = method.indexOf( '-', 1 ) + 1) > 0) {\r\n                prefix = method.substr( 0, prefix_i);\r\n                method = method.substr( prefix_i );\r\n            }\r\n            results.push({\r\n                prefix: prefix,\r\n                method: method.toLowerCase(),\r\n                value: block,\r\n                args: args\r\n            });\r\n        }\r\n        args = []; //for some odd reason, setting .length = 0 didn't work in safari\r\n        method =\r\n            prefix =\r\n            definition =\r\n            block = '';\r\n    };\r\n\r\n    appendResult();\r\n    for(var i = 0, ii = value.length; i<ii; i++) {\r\n        c = value[i];\r\n        if(mode === 0 && whitespace.indexOf( c ) > -1){\r\n            continue;\r\n        }\r\n        switch(c) {\r\n            case '\"':\r\n                if(!quote) {\r\n                    quote = c;\r\n                }\r\n                else if(quote === c) {\r\n                    quote = null;\r\n                }\r\n                break;\r\n\r\n            case '(':\r\n                if(quote) { break; }\r\n                else if(mode === 0) {\r\n                    mode = 1;\r\n                    block += c;\r\n                    continue;\r\n                } else {\r\n                    numParen++;\r\n                }\r\n                break;\r\n\r\n            case ')':\r\n                if(quote) { break; }\r\n                else if(mode === 1) {\r\n                    if(numParen === 0) {\r\n                        mode = 0;\r\n                        block += c;\r\n                        appendResult();\r\n                        continue;\r\n                    } else {\r\n                        numParen--;\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case ',':\r\n                if(quote) { break; }\r\n                else if(mode === 0) {\r\n                    appendResult();\r\n                    continue;\r\n                }\r\n                else if (mode === 1) {\r\n                    if(numParen === 0 && !method.match(/^url$/i)) {\r\n                        args.push(definition);\r\n                        definition = '';\r\n                        block += c;\r\n                        continue;\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n\r\n        block += c;\r\n        if(mode === 0) { method += c; }\r\n        else { definition += c; }\r\n    }\r\n    appendResult();\r\n\r\n    return results;\r\n};\r\n\r\n_html2canvas.Util.Bounds = function getBounds (el) {\r\n  var clientRect,\r\n  bounds = {};\r\n\r\n  if (el.getBoundingClientRect){\r\n    clientRect = el.getBoundingClientRect();\r\n\r\n\r\n    // TODO add scroll position to bounds, so no scrolling of window necessary\r\n    bounds.top = clientRect.top;\r\n    bounds.bottom = clientRect.bottom || (clientRect.top + clientRect.height);\r\n    bounds.left = clientRect.left;\r\n\r\n    // older IE doesn't have width/height, but top/bottom instead\r\n    bounds.width = clientRect.width || (clientRect.right - clientRect.left);\r\n    bounds.height = clientRect.height || (clientRect.bottom - clientRect.top);\r\n\r\n    return bounds;\r\n\r\n  }\r\n};\r\n\r\n_html2canvas.Util.getCSS = function (el, attribute, index) {\r\n  // return $(el).css(attribute);\r\n\r\n    var val,\r\n    isBackgroundSizePosition = attribute.match( /^background(Size|Position)$/ );\r\n\r\n  function toPX( attribute, val ) {\r\n    var rsLeft = el.runtimeStyle && el.runtimeStyle[ attribute ],\r\n    left,\r\n    style = el.style;\r\n\r\n    // Check if we are not dealing with pixels, (Opera has issues with this)\r\n    // Ported from jQuery css.js\r\n    // From the awesome hack by Dean Edwards\r\n    // http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291\r\n\r\n    // If we're not dealing with a regular pixel number\r\n    // but a number that has a weird ending, we need to convert it to pixels\r\n\r\n    if ( !/^-?[0-9]+\\.?[0-9]*(?:px)?$/i.test( val ) && /^-?\\d/.test( val ) ) {\r\n\r\n      // Remember the original values\r\n      left = style.left;\r\n\r\n      // Put in the new values to get a computed value out\r\n      if ( rsLeft ) {\r\n        el.runtimeStyle.left = el.currentStyle.left;\r\n      }\r\n      style.left = attribute === \"fontSize\" ? \"1em\" : (val || 0);\r\n      val = style.pixelLeft + \"px\";\r\n\r\n      // Revert the changed values\r\n      style.left = left;\r\n      if ( rsLeft ) {\r\n        el.runtimeStyle.left = rsLeft;\r\n      }\r\n\r\n    }\r\n\r\n    if (!/^(thin|medium|thick)$/i.test( val )) {\r\n      return Math.round(parseFloat( val )) + \"px\";\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n    if (previousElement !== el) {\r\n      computedCSS = document.defaultView.getComputedStyle(el, null);\r\n    }\r\n    val = computedCSS[attribute];\r\n\r\n    if (isBackgroundSizePosition) {\r\n      val = (val || '').split( ',' );\r\n      val = val[index || 0] || val[0] || 'auto';\r\n      val = _html2canvas.Util.trimText(val).split(' ');\r\n\r\n      if(attribute === 'backgroundSize' && (!val[ 0 ] || val[ 0 ].match( /cover|contain|auto/ ))) {\r\n        //these values will be handled in the parent function\r\n\r\n      } else {\r\n        val[ 0 ] = ( val[ 0 ].indexOf( \"%\" ) === -1 ) ? toPX(  attribute + \"X\", val[ 0 ] ) : val[ 0 ];\r\n        if(val[ 1 ] === undefined) {\r\n          if(attribute === 'backgroundSize') {\r\n            val[ 1 ] = 'auto';\r\n            return val;\r\n          }\r\n          else {\r\n            // IE 9 doesn't return double digit always\r\n            val[ 1 ] = val[ 0 ];\r\n          }\r\n        }\r\n        val[ 1 ] = ( val[ 1 ].indexOf( \"%\" ) === -1 ) ? toPX(  attribute + \"Y\", val[ 1 ] ) : val[ 1 ];\r\n      }\r\n    } else if ( /border(Top|Bottom)(Left|Right)Radius/.test( attribute) ) {\r\n      var arr = val.split(\" \");\r\n      if ( arr.length <= 1 ) {\r\n              arr[ 1 ] = arr[ 0 ];\r\n      }\r\n      arr[ 0 ] = parseInt( arr[ 0 ], 10 );\r\n      arr[ 1 ] = parseInt( arr[ 1 ], 10 );\r\n      val = arr;\r\n    }\r\n\r\n  return val;\r\n};\r\n\r\n_html2canvas.Util.resizeBounds = function( current_width, current_height, target_width, target_height, stretch_mode ){\r\n  var target_ratio = target_width / target_height,\r\n    current_ratio = current_width / current_height,\r\n    output_width, output_height;\r\n\r\n  if(!stretch_mode || stretch_mode === 'auto') {\r\n    output_width = target_width;\r\n    output_height = target_height;\r\n\r\n  } else {\r\n    if(target_ratio < current_ratio ^ stretch_mode === 'contain') {\r\n      output_height = target_height;\r\n      output_width = target_height * current_ratio;\r\n    } else {\r\n      output_width = target_width;\r\n      output_height = target_width / current_ratio;\r\n    }\r\n  }\r\n\r\n  return { width: output_width, height: output_height };\r\n};\r\n\r\nfunction backgroundBoundsFactory( prop, el, bounds, image, imageIndex, backgroundSize ) {\r\n    var bgposition =  _html2canvas.Util.getCSS( el, prop, imageIndex ) ,\r\n    topPos,\r\n    left,\r\n    percentage,\r\n    val;\r\n\r\n    if (bgposition.length === 1){\r\n      val = bgposition[0];\r\n\r\n      bgposition = [];\r\n\r\n      bgposition[0] = val;\r\n      bgposition[1] = val;\r\n    }\r\n\r\n    if (bgposition[0].toString().indexOf(\"%\") !== -1){\r\n      percentage = (parseFloat(bgposition[0])/100);\r\n      left = bounds.width * percentage;\r\n      if(prop !== 'backgroundSize') {\r\n        left -= (backgroundSize || image).width*percentage;\r\n      }\r\n\r\n    } else {\r\n      if(prop === 'backgroundSize') {\r\n        if(bgposition[0] === 'auto') {\r\n          left = image.width;\r\n\r\n        } else {\r\n          if(bgposition[0].match(/contain|cover/)) {\r\n            var resized = _html2canvas.Util.resizeBounds( image.width, image.height, bounds.width, bounds.height, bgposition[0] );\r\n            left = resized.width;\r\n            topPos = resized.height;\r\n          } else {\r\n            left = parseInt (bgposition[0], 10 );\r\n          }\r\n        }\r\n\r\n      } else {\r\n        left = parseInt( bgposition[0], 10 );\r\n      }\r\n    }\r\n\r\n\r\n    if(bgposition[1] === 'auto') {\r\n      topPos = left / image.width * image.height;\r\n    } else if (bgposition[1].toString().indexOf(\"%\") !== -1){\r\n      percentage = (parseFloat(bgposition[1])/100);\r\n      topPos =  bounds.height * percentage;\r\n      if(prop !== 'backgroundSize') {\r\n        topPos -= (backgroundSize || image).height * percentage;\r\n      }\r\n\r\n    } else {\r\n      topPos = parseInt(bgposition[1],10);\r\n    }\r\n\r\n    return [left, topPos];\r\n}\r\n\r\n_html2canvas.Util.BackgroundPosition = function( el, bounds, image, imageIndex, backgroundSize ) {\r\n    var result = backgroundBoundsFactory( 'backgroundPosition', el, bounds, image, imageIndex, backgroundSize );\r\n    return { left: result[0], top: result[1] };\r\n};\r\n_html2canvas.Util.BackgroundSize = function( el, bounds, image, imageIndex ) {\r\n    var result = backgroundBoundsFactory( 'backgroundSize', el, bounds, image, imageIndex );\r\n    return { width: result[0], height: result[1] };\r\n};\r\n\r\n_html2canvas.Util.Extend = function (options, defaults) {\r\n  for (var key in options) {\r\n    if (options.hasOwnProperty(key)) {\r\n      defaults[key] = options[key];\r\n    }\r\n  }\r\n  return defaults;\r\n};\r\n\r\n\r\n/*\r\n * Derived from jQuery.contents()\r\n * Copyright 2010, John Resig\r\n * Dual licensed under the MIT or GPL Version 2 licenses.\r\n * http://jquery.org/license\r\n */\r\n_html2canvas.Util.Children = function( elem ) {\r\n\r\n\r\n  var children;\r\n  try {\r\n\r\n    children = (elem.nodeName && elem.nodeName.toUpperCase() === \"IFRAME\") ?\r\n    elem.contentDocument || elem.contentWindow.document : (function( array ){\r\n      var ret = [];\r\n\r\n      if ( array !== null ) {\r\n\r\n        (function( first, second ) {\r\n          var i = first.length,\r\n          j = 0;\r\n\r\n          if ( typeof second.length === \"number\" ) {\r\n            for ( var l = second.length; j < l; j++ ) {\r\n              first[ i++ ] = second[ j ];\r\n            }\r\n\r\n          } else {\r\n            while ( second[j] !== undefined ) {\r\n              first[ i++ ] = second[ j++ ];\r\n            }\r\n          }\r\n\r\n          first.length = i;\r\n\r\n          return first;\r\n        })( ret, array );\r\n\r\n      }\r\n\r\n      return ret;\r\n    })( elem.childNodes );\r\n\r\n  } catch (ex) {\r\n    h2clog(\"html2canvas.Util.Children failed with exception: \" + ex.message);\r\n    children = [];\r\n  }\r\n  return children;\r\n};\r\n\r\n_html2canvas.Util.Font = (function () {\r\n\r\n  var fontData = {};\r\n\r\n  return function(font, fontSize, doc) {\r\n    if (fontData[font + \"-\" + fontSize] !== undefined) {\r\n      return fontData[font + \"-\" + fontSize];\r\n    }\r\n\r\n    var container = doc.createElement('div'),\r\n    img = doc.createElement('img'),\r\n    span = doc.createElement('span'),\r\n    sampleText = 'Hidden Text',\r\n    baseline,\r\n    middle,\r\n    metricsObj;\r\n\r\n    container.style.visibility = \"hidden\";\r\n    container.style.fontFamily = font;\r\n    container.style.fontSize = fontSize;\r\n    container.style.margin = 0;\r\n    container.style.padding = 0;\r\n\r\n    doc.body.appendChild(container);\r\n\r\n    // http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever (handtinywhite.gif)\r\n    img.src = \"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=\";\r\n    img.width = 1;\r\n    img.height = 1;\r\n\r\n    img.style.margin = 0;\r\n    img.style.padding = 0;\r\n    img.style.verticalAlign = \"baseline\";\r\n\r\n    span.style.fontFamily = font;\r\n    span.style.fontSize = fontSize;\r\n    span.style.margin = 0;\r\n    span.style.padding = 0;\r\n\r\n    span.appendChild(doc.createTextNode(sampleText));\r\n    container.appendChild(span);\r\n    container.appendChild(img);\r\n    baseline = (img.offsetTop - span.offsetTop) + 1;\r\n\r\n    container.removeChild(span);\r\n    container.appendChild(doc.createTextNode(sampleText));\r\n\r\n    container.style.lineHeight = \"normal\";\r\n    img.style.verticalAlign = \"super\";\r\n\r\n    middle = (img.offsetTop-container.offsetTop) + 1;\r\n    metricsObj = {\r\n      baseline: baseline,\r\n      lineWidth: 1,\r\n      middle: middle\r\n    };\r\n\r\n    fontData[font + \"-\" + fontSize] = metricsObj;\r\n\r\n    doc.body.removeChild(container);\r\n\r\n    return metricsObj;\r\n  };\r\n})();\r\n\r\n(function(){\r\n\r\n  _html2canvas.Generate = {};\r\n\r\n  var reGradients = [\r\n  /^(-webkit-linear-gradient)\\(([a-z\\s]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\r\n  /^(-o-linear-gradient)\\(([a-z\\s]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\r\n  /^(-webkit-gradient)\\((linear|radial),\\s((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?),\\s(?:\\d{1,3}%?)\\s(?:\\d{1,3}%?))([\\w\\d\\.\\s,%\\(\\)\\-]+)\\)$/,\r\n  /^(-moz-linear-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?))([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\r\n  /^(-webkit-radial-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?)),\\s(\\w+)\\s([a-z\\-]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\r\n  /^(-moz-radial-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?)),\\s(\\w+)\\s?([a-z\\-]*)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\r\n  /^(-o-radial-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?)),\\s(\\w+)\\s([a-z\\-]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/\r\n  ];\r\n\r\n  /*\r\n * TODO: Add IE10 vendor prefix (-ms) support\r\n * TODO: Add W3C gradient (linear-gradient) support\r\n * TODO: Add old Webkit -webkit-gradient(radial, ...) support\r\n * TODO: Maybe some RegExp optimizations are possible ;o)\r\n */\r\n  _html2canvas.Generate.parseGradient = function(css, bounds) {\r\n    var gradient, i, len = reGradients.length, m1, stop, m2, m2Len, step, m3, tl,tr,br,bl;\r\n\r\n    for(i = 0; i < len; i+=1){\r\n      m1 = css.match(reGradients[i]);\r\n      if(m1) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(m1) {\r\n      switch(m1[1]) {\r\n        case '-webkit-linear-gradient':\r\n        case '-o-linear-gradient':\r\n\r\n          gradient = {\r\n            type: 'linear',\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null,\r\n            colorStops: []\r\n          };\r\n\r\n          // get coordinates\r\n          m2 = m1[2].match(/\\w+/g);\r\n          if(m2){\r\n            m2Len = m2.length;\r\n            for(i = 0; i < m2Len; i+=1){\r\n              switch(m2[i]) {\r\n                case 'top':\r\n                  gradient.y0 = 0;\r\n                  gradient.y1 = bounds.height;\r\n                  break;\r\n\r\n                case 'right':\r\n                  gradient.x0 = bounds.width;\r\n                  gradient.x1 = 0;\r\n                  break;\r\n\r\n                case 'bottom':\r\n                  gradient.y0 = bounds.height;\r\n                  gradient.y1 = 0;\r\n                  break;\r\n\r\n                case 'left':\r\n                  gradient.x0 = 0;\r\n                  gradient.x1 = bounds.width;\r\n                  break;\r\n              }\r\n            }\r\n          }\r\n          if(gradient.x0 === null && gradient.x1 === null){ // center\r\n            gradient.x0 = gradient.x1 = bounds.width / 2;\r\n          }\r\n          if(gradient.y0 === null && gradient.y1 === null){ // center\r\n            gradient.y0 = gradient.y1 = bounds.height / 2;\r\n          }\r\n\r\n          // get colors and stops\r\n          m2 = m1[3].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)(?:\\s\\d{1,3}(?:%|px))?)+/g);\r\n          if(m2){\r\n            m2Len = m2.length;\r\n            step = 1 / Math.max(m2Len - 1, 1);\r\n            for(i = 0; i < m2Len; i+=1){\r\n              m3 = m2[i].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\s*(\\d{1,3})?(%|px)?/);\r\n              if(m3[2]){\r\n                stop = parseFloat(m3[2]);\r\n                if(m3[3] === '%'){\r\n                  stop /= 100;\r\n                } else { // px - stupid opera\r\n                  stop /= bounds.width;\r\n                }\r\n              } else {\r\n                stop = i * step;\r\n              }\r\n              gradient.colorStops.push({\r\n                color: m3[1],\r\n                stop: stop\r\n              });\r\n            }\r\n          }\r\n          break;\r\n\r\n        case '-webkit-gradient':\r\n\r\n          gradient = {\r\n            type: m1[2] === 'radial' ? 'circle' : m1[2], // TODO: Add radial gradient support for older mozilla definitions\r\n            x0: 0,\r\n            y0: 0,\r\n            x1: 0,\r\n            y1: 0,\r\n            colorStops: []\r\n          };\r\n\r\n          // get coordinates\r\n          m2 = m1[3].match(/(\\d{1,3})%?\\s(\\d{1,3})%?,\\s(\\d{1,3})%?\\s(\\d{1,3})%?/);\r\n          if(m2){\r\n            gradient.x0 = (m2[1] * bounds.width) / 100;\r\n            gradient.y0 = (m2[2] * bounds.height) / 100;\r\n            gradient.x1 = (m2[3] * bounds.width) / 100;\r\n            gradient.y1 = (m2[4] * bounds.height) / 100;\r\n          }\r\n\r\n          // get colors and stops\r\n          m2 = m1[4].match(/((?:from|to|color-stop)\\((?:[0-9\\.]+,\\s)?(?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)\\))+/g);\r\n          if(m2){\r\n            m2Len = m2.length;\r\n            for(i = 0; i < m2Len; i+=1){\r\n              m3 = m2[i].match(/(from|to|color-stop)\\(([0-9\\.]+)?(?:,\\s)?((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\)/);\r\n              stop = parseFloat(m3[2]);\r\n              if(m3[1] === 'from') {\r\n                stop = 0.0;\r\n              }\r\n              if(m3[1] === 'to') {\r\n                stop = 1.0;\r\n              }\r\n              gradient.colorStops.push({\r\n                color: m3[3],\r\n                stop: stop\r\n              });\r\n            }\r\n          }\r\n          break;\r\n\r\n        case '-moz-linear-gradient':\r\n\r\n          gradient = {\r\n            type: 'linear',\r\n            x0: 0,\r\n            y0: 0,\r\n            x1: 0,\r\n            y1: 0,\r\n            colorStops: []\r\n          };\r\n\r\n          // get coordinates\r\n          m2 = m1[2].match(/(\\d{1,3})%?\\s(\\d{1,3})%?/);\r\n\r\n          // m2[1] == 0%   -> left\r\n          // m2[1] == 50%  -> center\r\n          // m2[1] == 100% -> right\r\n\r\n          // m2[2] == 0%   -> top\r\n          // m2[2] == 50%  -> center\r\n          // m2[2] == 100% -> bottom\r\n\r\n          if(m2){\r\n            gradient.x0 = (m2[1] * bounds.width) / 100;\r\n            gradient.y0 = (m2[2] * bounds.height) / 100;\r\n            gradient.x1 = bounds.width - gradient.x0;\r\n            gradient.y1 = bounds.height - gradient.y0;\r\n          }\r\n\r\n          // get colors and stops\r\n          m2 = m1[3].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)(?:\\s\\d{1,3}%)?)+/g);\r\n          if(m2){\r\n            m2Len = m2.length;\r\n            step = 1 / Math.max(m2Len - 1, 1);\r\n            for(i = 0; i < m2Len; i+=1){\r\n              m3 = m2[i].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\s*(\\d{1,3})?(%)?/);\r\n              if(m3[2]){\r\n                stop = parseFloat(m3[2]);\r\n                if(m3[3]){ // percentage\r\n                  stop /= 100;\r\n                }\r\n              } else {\r\n                stop = i * step;\r\n              }\r\n              gradient.colorStops.push({\r\n                color: m3[1],\r\n                stop: stop\r\n              });\r\n            }\r\n          }\r\n          break;\r\n\r\n        case '-webkit-radial-gradient':\r\n        case '-moz-radial-gradient':\r\n        case '-o-radial-gradient':\r\n\r\n          gradient = {\r\n            type: 'circle',\r\n            x0: 0,\r\n            y0: 0,\r\n            x1: bounds.width,\r\n            y1: bounds.height,\r\n            cx: 0,\r\n            cy: 0,\r\n            rx: 0,\r\n            ry: 0,\r\n            colorStops: []\r\n          };\r\n\r\n          // center\r\n          m2 = m1[2].match(/(\\d{1,3})%?\\s(\\d{1,3})%?/);\r\n          if(m2){\r\n            gradient.cx = (m2[1] * bounds.width) / 100;\r\n            gradient.cy = (m2[2] * bounds.height) / 100;\r\n          }\r\n\r\n          // size\r\n          m2 = m1[3].match(/\\w+/);\r\n          m3 = m1[4].match(/[a-z\\-]*/);\r\n          if(m2 && m3){\r\n            switch(m3[0]){\r\n              case 'farthest-corner':\r\n              case 'cover': // is equivalent to farthest-corner\r\n              case '': // mozilla removes \"cover\" from definition :(\r\n                tl = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.cy, 2));\r\n                tr = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\r\n                br = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\r\n                bl = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.cy, 2));\r\n                gradient.rx = gradient.ry = Math.max(tl, tr, br, bl);\r\n                break;\r\n              case 'closest-corner':\r\n                tl = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.cy, 2));\r\n                tr = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\r\n                br = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\r\n                bl = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.cy, 2));\r\n                gradient.rx = gradient.ry = Math.min(tl, tr, br, bl);\r\n                break;\r\n              case 'farthest-side':\r\n                if(m2[0] === 'circle'){\r\n                  gradient.rx = gradient.ry = Math.max(\r\n                    gradient.cx,\r\n                    gradient.cy,\r\n                    gradient.x1 - gradient.cx,\r\n                    gradient.y1 - gradient.cy\r\n                    );\r\n                } else { // ellipse\r\n\r\n                  gradient.type = m2[0];\r\n\r\n                  gradient.rx = Math.max(\r\n                    gradient.cx,\r\n                    gradient.x1 - gradient.cx\r\n                    );\r\n                  gradient.ry = Math.max(\r\n                    gradient.cy,\r\n                    gradient.y1 - gradient.cy\r\n                    );\r\n                }\r\n                break;\r\n              case 'closest-side':\r\n              case 'contain': // is equivalent to closest-side\r\n                if(m2[0] === 'circle'){\r\n                  gradient.rx = gradient.ry = Math.min(\r\n                    gradient.cx,\r\n                    gradient.cy,\r\n                    gradient.x1 - gradient.cx,\r\n                    gradient.y1 - gradient.cy\r\n                    );\r\n                } else { // ellipse\r\n\r\n                  gradient.type = m2[0];\r\n\r\n                  gradient.rx = Math.min(\r\n                    gradient.cx,\r\n                    gradient.x1 - gradient.cx\r\n                    );\r\n                  gradient.ry = Math.min(\r\n                    gradient.cy,\r\n                    gradient.y1 - gradient.cy\r\n                    );\r\n                }\r\n                break;\r\n\r\n            // TODO: add support for \"30px 40px\" sizes (webkit only)\r\n            }\r\n          }\r\n\r\n          // color stops\r\n          m2 = m1[5].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)(?:\\s\\d{1,3}(?:%|px))?)+/g);\r\n          if(m2){\r\n            m2Len = m2.length;\r\n            step = 1 / Math.max(m2Len - 1, 1);\r\n            for(i = 0; i < m2Len; i+=1){\r\n              m3 = m2[i].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\s*(\\d{1,3})?(%|px)?/);\r\n              if(m3[2]){\r\n                stop = parseFloat(m3[2]);\r\n                if(m3[3] === '%'){\r\n                  stop /= 100;\r\n                } else { // px - stupid opera\r\n                  stop /= bounds.width;\r\n                }\r\n              } else {\r\n                stop = i * step;\r\n              }\r\n              gradient.colorStops.push({\r\n                color: m3[1],\r\n                stop: stop\r\n              });\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    return gradient;\r\n  };\r\n\r\n  _html2canvas.Generate.Gradient = function(src, bounds) {\r\n    if(bounds.width === 0 || bounds.height === 0) {\r\n      return;\r\n    }\r\n\r\n    var canvas = document.createElement('canvas'),\r\n    ctx = canvas.getContext('2d'),\r\n    gradient, grad, i, len;\r\n\r\n    canvas.width = bounds.width;\r\n    canvas.height = bounds.height;\r\n\r\n    // TODO: add support for multi defined background gradients\r\n    gradient = _html2canvas.Generate.parseGradient(src, bounds);\r\n\r\n    if(gradient) {\r\n      if(gradient.type === 'linear') {\r\n        grad = ctx.createLinearGradient(gradient.x0, gradient.y0, gradient.x1, gradient.y1);\r\n\r\n        for (i = 0, len = gradient.colorStops.length; i < len; i+=1) {\r\n          try {\r\n            grad.addColorStop(gradient.colorStops[i].stop, gradient.colorStops[i].color);\r\n          }\r\n          catch(e) {\r\n            h2clog(['failed to add color stop: ', e, '; tried to add: ', gradient.colorStops[i], '; stop: ', i, '; in: ', src]);\r\n          }\r\n        }\r\n\r\n        ctx.fillStyle = grad;\r\n        ctx.fillRect(0, 0, bounds.width, bounds.height);\r\n\r\n      } else if(gradient.type === 'circle') {\r\n\r\n        grad = ctx.createRadialGradient(gradient.cx, gradient.cy, 0, gradient.cx, gradient.cy, gradient.rx);\r\n\r\n        for (i = 0, len = gradient.colorStops.length; i < len; i+=1) {\r\n          try {\r\n            grad.addColorStop(gradient.colorStops[i].stop, gradient.colorStops[i].color);\r\n          }\r\n          catch(e) {\r\n            h2clog(['failed to add color stop: ', e, '; tried to add: ', gradient.colorStops[i], '; stop: ', i, '; in: ', src]);\r\n          }\r\n        }\r\n\r\n        ctx.fillStyle = grad;\r\n        ctx.fillRect(0, 0, bounds.width, bounds.height);\r\n\r\n      } else if(gradient.type === 'ellipse') {\r\n\r\n        // draw circle\r\n        var canvasRadial = document.createElement('canvas'),\r\n        ctxRadial = canvasRadial.getContext('2d'),\r\n        ri = Math.max(gradient.rx, gradient.ry),\r\n        di = ri * 2, imgRadial;\r\n\r\n        canvasRadial.width = canvasRadial.height = di;\r\n\r\n        grad = ctxRadial.createRadialGradient(gradient.rx, gradient.ry, 0, gradient.rx, gradient.ry, ri);\r\n\r\n        for (i = 0, len = gradient.colorStops.length; i < len; i+=1) {\r\n          try {\r\n            grad.addColorStop(gradient.colorStops[i].stop, gradient.colorStops[i].color);\r\n          }\r\n          catch(e) {\r\n            h2clog(['failed to add color stop: ', e, '; tried to add: ', gradient.colorStops[i], '; stop: ', i, '; in: ', src]);\r\n          }\r\n        }\r\n\r\n        ctxRadial.fillStyle = grad;\r\n        ctxRadial.fillRect(0, 0, di, di);\r\n\r\n        ctx.fillStyle = gradient.colorStops[i - 1].color;\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        ctx.drawImage(canvasRadial, gradient.cx - gradient.rx, gradient.cy - gradient.ry, 2 * gradient.rx, 2 * gradient.ry);\r\n\r\n      }\r\n    }\r\n\r\n    return canvas;\r\n  };\r\n\r\n  _html2canvas.Generate.ListAlpha = function(number) {\r\n    var tmp = \"\",\r\n    modulus;\r\n\r\n    do {\r\n      modulus = number % 26;\r\n      tmp = String.fromCharCode((modulus) + 64) + tmp;\r\n      number = number / 26;\r\n    }while((number*26) > 26);\r\n\r\n    return tmp;\r\n  };\r\n\r\n  _html2canvas.Generate.ListRoman = function(number) {\r\n    var romanArray = [\"M\", \"CM\", \"D\", \"CD\", \"C\", \"XC\", \"L\", \"XL\", \"X\", \"IX\", \"V\", \"IV\", \"I\"],\r\n    decimal = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1],\r\n    roman = \"\",\r\n    v,\r\n    len = romanArray.length;\r\n\r\n    if (number <= 0 || number >= 4000) {\r\n      return number;\r\n    }\r\n\r\n    for (v=0; v < len; v+=1) {\r\n      while (number >= decimal[v]) {\r\n        number -= decimal[v];\r\n        roman += romanArray[v];\r\n      }\r\n    }\r\n\r\n    return roman;\r\n\r\n  };\r\n\r\n})();\r\nfunction h2cRenderContext(width, height) {\r\n  var storage = [];\r\n  return {\r\n    storage: storage,\r\n    width: width,\r\n    height: height,\r\n    clip: function() {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"clip\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    translate: function() {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"translate\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    fill: function() {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"fill\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    save: function() {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"save\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    restore: function() {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"restore\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    fillRect: function () {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"fillRect\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    createPattern: function() {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"createPattern\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    drawShape: function() {\r\n\r\n      var shape = [];\r\n\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"drawShape\",\r\n        'arguments': shape\r\n      });\r\n\r\n      return {\r\n        moveTo: function() {\r\n          shape.push({\r\n            name: \"moveTo\",\r\n            'arguments': arguments\r\n          });\r\n        },\r\n        lineTo: function() {\r\n          shape.push({\r\n            name: \"lineTo\",\r\n            'arguments': arguments\r\n          });\r\n        },\r\n        arcTo: function() {\r\n          shape.push({\r\n            name: \"arcTo\",\r\n            'arguments': arguments\r\n          });\r\n        },\r\n        bezierCurveTo: function() {\r\n          shape.push({\r\n            name: \"bezierCurveTo\",\r\n            'arguments': arguments\r\n          });\r\n        },\r\n        quadraticCurveTo: function() {\r\n          shape.push({\r\n            name: \"quadraticCurveTo\",\r\n            'arguments': arguments\r\n          });\r\n        }\r\n      };\r\n\r\n    },\r\n    drawImage: function () {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"drawImage\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    fillText: function () {\r\n      storage.push({\r\n        type: \"function\",\r\n        name: \"fillText\",\r\n        'arguments': arguments\r\n      });\r\n    },\r\n    setVariable: function (variable, value) {\r\n      storage.push({\r\n        type: \"variable\",\r\n        name: variable,\r\n        'arguments': value\r\n      });\r\n    }\r\n  };\r\n}\r\n_html2canvas.Parse = function (images, options) {\r\n  window.scroll(0,0);\r\n\r\n  var element = (( options.elements === undefined ) ? document.body : options.elements[0]), // select body by default\r\n  numDraws = 0,\r\n  doc = element.ownerDocument,\r\n  support = _html2canvas.Util.Support(options, doc),\r\n  ignoreElementsRegExp = new RegExp(\"(\" + options.ignoreElements + \")\"),\r\n  body = doc.body,\r\n  getCSS = _html2canvas.Util.getCSS,\r\n  pseudoHide = \"___html2canvas___pseudoelement\",\r\n  hidePseudoElements = doc.createElement('style');\r\n\r\n  hidePseudoElements.innerHTML = '.' + pseudoHide + '-before:before { content: \"\" !important; display: none !important; }' +\r\n  '.' + pseudoHide + '-after:after { content: \"\" !important; display: none !important; }';\r\n\r\n  body.appendChild(hidePseudoElements);\r\n\r\n  images = images || {};\r\n\r\n  function documentWidth () {\r\n    return Math.max(\r\n      Math.max(doc.body.scrollWidth, doc.documentElement.scrollWidth),\r\n      Math.max(doc.body.offsetWidth, doc.documentElement.offsetWidth),\r\n      Math.max(doc.body.clientWidth, doc.documentElement.clientWidth)\r\n      );\r\n  }\r\n\r\n  function documentHeight () {\r\n    return Math.max(\r\n      Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight),\r\n      Math.max(doc.body.offsetHeight, doc.documentElement.offsetHeight),\r\n      Math.max(doc.body.clientHeight, doc.documentElement.clientHeight)\r\n      );\r\n  }\r\n\r\n  function getCSSInt(element, attribute) {\r\n    var val = parseInt(getCSS(element, attribute), 10);\r\n    return (isNaN(val)) ? 0 : val; // borders in old IE are throwing 'medium' for demo.html\r\n  }\r\n\r\n  function renderRect (ctx, x, y, w, h, bgcolor) {\r\n    if (bgcolor !== \"transparent\"){\r\n      ctx.setVariable(\"fillStyle\", bgcolor);\r\n      ctx.fillRect(x, y, w, h);\r\n      numDraws+=1;\r\n    }\r\n  }\r\n\r\n  function textTransform (text, transform) {\r\n    switch(transform){\r\n      case \"lowercase\":\r\n        return text.toLowerCase();\r\n      case \"capitalize\":\r\n        return text.replace( /(^|\\s|:|-|\\(|\\))([a-z])/g , function (m, p1, p2) {\r\n          if (m.length > 0) {\r\n            return p1 + p2.toUpperCase();\r\n          }\r\n        } );\r\n      case \"uppercase\":\r\n        return text.toUpperCase();\r\n      default:\r\n        return text;\r\n    }\r\n  }\r\n\r\n  function noLetterSpacing(letter_spacing) {\r\n    return (/^(normal|none|0px)$/.test(letter_spacing));\r\n  }\r\n\r\n  function drawText(currentText, x, y, ctx){\r\n    if (currentText !== null && _html2canvas.Util.trimText(currentText).length > 0) {\r\n      ctx.fillText(currentText, x, y);\r\n      numDraws+=1;\r\n    }\r\n  }\r\n\r\n  function setTextVariables(ctx, el, text_decoration, color) {\r\n    var align = false,\r\n    bold = getCSS(el, \"fontWeight\"),\r\n    family = getCSS(el, \"fontFamily\"),\r\n    size = getCSS(el, \"fontSize\");\r\n\r\n    switch(parseInt(bold, 10)){\r\n      case 401:\r\n        bold = \"bold\";\r\n        break;\r\n      case 400:\r\n        bold = \"normal\";\r\n        break;\r\n    }\r\n\r\n    ctx.setVariable(\"fillStyle\", color);\r\n    ctx.setVariable(\"font\", [getCSS(el, \"fontStyle\"), getCSS(el, \"fontVariant\"), bold, size, family].join(\" \"));\r\n    ctx.setVariable(\"textAlign\", (align) ? \"right\" : \"left\");\r\n\r\n    if (text_decoration !== \"none\"){\r\n      return _html2canvas.Util.Font(family, size, doc);\r\n    }\r\n  }\r\n\r\n  function renderTextDecoration(ctx, text_decoration, bounds, metrics, color) {\r\n    switch(text_decoration) {\r\n      case \"underline\":\r\n        // Draws a line at the baseline of the font\r\n        // TODO As some browsers display the line as more than 1px if the font-size is big, need to take that into account both in position and size\r\n        renderRect(ctx, bounds.left, Math.round(bounds.top + metrics.baseline + metrics.lineWidth), bounds.width, 1, color);\r\n        break;\r\n      case \"overline\":\r\n        renderRect(ctx, bounds.left, Math.round(bounds.top), bounds.width, 1, color);\r\n        break;\r\n      case \"line-through\":\r\n        // TODO try and find exact position for line-through\r\n        renderRect(ctx, bounds.left, Math.ceil(bounds.top + metrics.middle + metrics.lineWidth), bounds.width, 1, color);\r\n        break;\r\n    }\r\n  }\r\n\r\n  function getTextBounds(state, text, textDecoration, isLast) {\r\n    var bounds;\r\n    if (support.rangeBounds) {\r\n      if (textDecoration !== \"none\" || _html2canvas.Util.trimText(text).length !== 0) {\r\n        bounds = textRangeBounds(text, state.node, state.textOffset);\r\n      }\r\n      state.textOffset += text.length;\r\n    } else if (state.node && typeof state.node.nodeValue === \"string\" ){\r\n      var newTextNode = (isLast) ? state.node.splitText(text.length) : null;\r\n      bounds = textWrapperBounds(state.node);\r\n      state.node = newTextNode;\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  function textRangeBounds(text, textNode, textOffset) {\r\n    var range = doc.createRange();\r\n    range.setStart(textNode, textOffset);\r\n    range.setEnd(textNode, textOffset + text.length);\r\n    return range.getBoundingClientRect();\r\n  }\r\n\r\n  function textWrapperBounds(oldTextNode) {\r\n    var parent = oldTextNode.parentNode,\r\n    wrapElement = doc.createElement('wrapper'),\r\n    backupText = oldTextNode.cloneNode(true);\r\n\r\n    wrapElement.appendChild(oldTextNode.cloneNode(true));\r\n    parent.replaceChild(wrapElement, oldTextNode);\r\n\r\n    var bounds = _html2canvas.Util.Bounds(wrapElement);\r\n    parent.replaceChild(backupText, wrapElement);\r\n    return bounds;\r\n  }\r\n\r\n  function renderText(el, textNode, stack) {\r\n    var ctx = stack.ctx,\r\n    color = getCSS(el, \"color\"),\r\n    textDecoration = getCSS(el, \"textDecoration\"),\r\n    textAlign = getCSS(el, \"textAlign\"),\r\n    metrics,\r\n    textList,\r\n    state = {\r\n      node: textNode,\r\n      textOffset: 0\r\n    };\r\n\r\n    if (_html2canvas.Util.trimText(textNode.nodeValue).length > 0) {\r\n      textNode.nodeValue = textTransform(textNode.nodeValue, getCSS(el, \"textTransform\"));\r\n      textAlign = textAlign.replace([\"-webkit-auto\"],[\"auto\"]);\r\n\r\n      textList = (!options.letterRendering && /^(left|right|justify|auto)$/.test(textAlign) && noLetterSpacing(getCSS(el, \"letterSpacing\"))) ?\r\n      textNode.nodeValue.split(/(\\b| )/)\r\n      : textNode.nodeValue.split(\"\");\r\n\r\n      metrics = setTextVariables(ctx, el, textDecoration, color);\r\n\r\n      if (options.chinese) {\r\n        textList.forEach(function(word, index) {\r\n          if (/.*[\\u4E00-\\u9FA5].*$/.test(word)) {\r\n            word = word.split(\"\");\r\n            word.unshift(index, 1);\r\n            textList.splice.apply(textList, word);\r\n          }\r\n        });\r\n      }\r\n\r\n      textList.forEach(function(text, index) {\r\n        var bounds = getTextBounds(state, text, textDecoration, (index < textList.length - 1));\r\n        if (bounds) {\r\n          drawText(text, bounds.left, bounds.bottom, ctx);\r\n          renderTextDecoration(ctx, textDecoration, bounds, metrics, color);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function listPosition (element, val) {\r\n    var boundElement = doc.createElement( \"boundelement\" ),\r\n    originalType,\r\n    bounds;\r\n\r\n    boundElement.style.display = \"inline\";\r\n\r\n    originalType = element.style.listStyleType;\r\n    element.style.listStyleType = \"none\";\r\n\r\n    boundElement.appendChild(doc.createTextNode(val));\r\n\r\n    element.insertBefore(boundElement, element.firstChild);\r\n\r\n    bounds = _html2canvas.Util.Bounds(boundElement);\r\n    element.removeChild(boundElement);\r\n    element.style.listStyleType = originalType;\r\n    return bounds;\r\n  }\r\n\r\n  function elementIndex( el ) {\r\n    var i = -1,\r\n    count = 1,\r\n    childs = el.parentNode.childNodes;\r\n\r\n    if (el.parentNode) {\r\n      while( childs[ ++i ] !== el ) {\r\n        if ( childs[ i ].nodeType === 1 ) {\r\n          count++;\r\n        }\r\n      }\r\n      return count;\r\n    } else {\r\n      return -1;\r\n    }\r\n  }\r\n\r\n  function listItemText(element, type) {\r\n    var currentIndex = elementIndex(element),\r\n    text;\r\n    switch(type){\r\n      case \"decimal\":\r\n        text = currentIndex;\r\n        break;\r\n      case \"decimal-leading-zero\":\r\n        text = (currentIndex.toString().length === 1) ? currentIndex = \"0\" + currentIndex.toString() : currentIndex.toString();\r\n        break;\r\n      case \"upper-roman\":\r\n        text = _html2canvas.Generate.ListRoman( currentIndex );\r\n        break;\r\n      case \"lower-roman\":\r\n        text = _html2canvas.Generate.ListRoman( currentIndex ).toLowerCase();\r\n        break;\r\n      case \"lower-alpha\":\r\n        text = _html2canvas.Generate.ListAlpha( currentIndex ).toLowerCase();\r\n        break;\r\n      case \"upper-alpha\":\r\n        text = _html2canvas.Generate.ListAlpha( currentIndex );\r\n        break;\r\n    }\r\n\r\n    text += \". \";\r\n    return text;\r\n  }\r\n\r\n  function renderListItem(element, stack, elBounds) {\r\n    var x,\r\n    text,\r\n    ctx = stack.ctx,\r\n    type = getCSS(element, \"listStyleType\"),\r\n    listBounds;\r\n\r\n    if (/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(type)) {\r\n      text = listItemText(element, type);\r\n      listBounds = listPosition(element, text);\r\n      setTextVariables(ctx, element, \"none\", getCSS(element, \"color\"));\r\n\r\n      if (getCSS(element, \"listStylePosition\") === \"inside\") {\r\n        ctx.setVariable(\"textAlign\", \"left\");\r\n        x = elBounds.left;\r\n      } else {\r\n        return;\r\n      }\r\n\r\n      drawText(text, x, listBounds.bottom, ctx);\r\n    }\r\n  }\r\n\r\n  function loadImage (src){\r\n    var img = images[src];\r\n    if (img && img.succeeded === true) {\r\n      return img.img;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function clipBounds(src, dst){\r\n    var x = Math.max(src.left, dst.left),\r\n    y = Math.max(src.top, dst.top),\r\n    x2 = Math.min((src.left + src.width), (dst.left + dst.width)),\r\n    y2 = Math.min((src.top + src.height), (dst.top + dst.height));\r\n\r\n    return {\r\n      left:x,\r\n      top:y,\r\n      width:x2-x,\r\n      height:y2-y\r\n    };\r\n  }\r\n\r\n  function setZ(zIndex, parentZ){\r\n    // TODO fix static elements overlapping relative/absolute elements under same stack, if they are defined after them\r\n    var newContext;\r\n    if (!parentZ){\r\n      newContext = h2czContext(0);\r\n      return newContext;\r\n    }\r\n\r\n    if (zIndex !== \"auto\"){\r\n      newContext = h2czContext(zIndex);\r\n      parentZ.children.push(newContext);\r\n      return newContext;\r\n\r\n    }\r\n\r\n    return parentZ;\r\n  }\r\n\r\n  function renderImage(ctx, element, image, bounds, borders) {\r\n\r\n    var paddingLeft = getCSSInt(element, 'paddingLeft'),\r\n    paddingTop = getCSSInt(element, 'paddingTop'),\r\n    paddingRight = getCSSInt(element, 'paddingRight'),\r\n    paddingBottom = getCSSInt(element, 'paddingBottom');\r\n\r\n    drawImage(\r\n      ctx,\r\n      image,\r\n      0, //sx\r\n      0, //sy\r\n      image.width, //sw\r\n      image.height, //sh\r\n      bounds.left + paddingLeft + borders[3].width, //dx\r\n      bounds.top + paddingTop + borders[0].width, // dy\r\n      bounds.width - (borders[1].width + borders[3].width + paddingLeft + paddingRight), //dw\r\n      bounds.height - (borders[0].width + borders[2].width + paddingTop + paddingBottom) //dh\r\n      );\r\n  }\r\n\r\n  function getBorderData(element) {\r\n    return [\"Top\", \"Right\", \"Bottom\", \"Left\"].map(function(side) {\r\n      return {\r\n        width: getCSSInt(element, 'border' + side + 'Width'),\r\n        color: getCSS(element, 'border' + side + 'Color')\r\n      };\r\n    });\r\n  }\r\n\r\n  function getBorderRadiusData(element) {\r\n    return [\"TopLeft\", \"TopRight\", \"BottomRight\", \"BottomLeft\"].map(function(side) {\r\n      return getCSS(element, 'border' + side + 'Radius');\r\n    });\r\n  }\r\n\r\n  var getCurvePoints = (function(kappa) {\r\n\r\n    return function(x, y, r1, r2) {\r\n      var ox = (r1) * kappa, // control point offset horizontal\r\n      oy = (r2) * kappa, // control point offset vertical\r\n      xm = x + r1, // x-middle\r\n      ym = y + r2; // y-middle\r\n      return {\r\n        topLeft: bezierCurve({\r\n          x:x,\r\n          y:ym\r\n        }, {\r\n          x:x,\r\n          y:ym - oy\r\n        }, {\r\n          x:xm - ox,\r\n          y:y\r\n        }, {\r\n          x:xm,\r\n          y:y\r\n        }),\r\n        topRight: bezierCurve({\r\n          x:x,\r\n          y:y\r\n        }, {\r\n          x:x + ox,\r\n          y:y\r\n        }, {\r\n          x:xm,\r\n          y:ym - oy\r\n        }, {\r\n          x:xm,\r\n          y:ym\r\n        }),\r\n        bottomRight: bezierCurve({\r\n          x:xm,\r\n          y:y\r\n        }, {\r\n          x:xm,\r\n          y:y + oy\r\n        }, {\r\n          x:x + ox,\r\n          y:ym\r\n        }, {\r\n          x:x,\r\n          y:ym\r\n        }),\r\n        bottomLeft: bezierCurve({\r\n          x:xm,\r\n          y:ym\r\n        }, {\r\n          x:xm - ox,\r\n          y:ym\r\n        }, {\r\n          x:x,\r\n          y:y + oy\r\n        }, {\r\n          x:x,\r\n          y:y\r\n        })\r\n      };\r\n    };\r\n  })(4 * ((Math.sqrt(2) - 1) / 3));\r\n\r\n  function bezierCurve(start, startControl, endControl, end) {\r\n\r\n    var lerp = function (a, b, t) {\r\n      return {\r\n        x:a.x + (b.x - a.x) * t,\r\n        y:a.y + (b.y - a.y) * t\r\n      };\r\n    };\r\n\r\n    return {\r\n      start: start,\r\n      startControl: startControl,\r\n      endControl: endControl,\r\n      end: end,\r\n      subdivide: function(t) {\r\n        var ab = lerp(start, startControl, t),\r\n        bc = lerp(startControl, endControl, t),\r\n        cd = lerp(endControl, end, t),\r\n        abbc = lerp(ab, bc, t),\r\n        bccd = lerp(bc, cd, t),\r\n        dest = lerp(abbc, bccd, t);\r\n        return [bezierCurve(start, ab, abbc, dest), bezierCurve(dest, bccd, cd, end)];\r\n      },\r\n      curveTo: function(borderArgs) {\r\n        borderArgs.push([\"bezierCurve\", startControl.x, startControl.y, endControl.x, endControl.y, end.x, end.y]);\r\n      },\r\n      curveToReversed: function(borderArgs) {\r\n        borderArgs.push([\"bezierCurve\", endControl.x, endControl.y, startControl.x, startControl.y, start.x, start.y]);\r\n      }\r\n    };\r\n  }\r\n\r\n  function parseCorner(borderArgs, radius1, radius2, corner1, corner2, x, y) {\r\n    if (radius1[0] > 0 || radius1[1] > 0) {\r\n      borderArgs.push([\"line\", corner1[0].start.x, corner1[0].start.y]);\r\n      corner1[0].curveTo(borderArgs);\r\n      corner1[1].curveTo(borderArgs);\r\n    } else {\r\n      borderArgs.push([\"line\", x, y]);\r\n    }\r\n\r\n    if (radius2[0] > 0 || radius2[1] > 0) {\r\n      borderArgs.push([\"line\", corner2[0].start.x, corner2[0].start.y]);\r\n    }\r\n  }\r\n\r\n  function drawSide(borderData, radius1, radius2, outer1, inner1, outer2, inner2) {\r\n    var borderArgs = [];\r\n\r\n    if (radius1[0] > 0 || radius1[1] > 0) {\r\n      borderArgs.push([\"line\", outer1[1].start.x, outer1[1].start.y]);\r\n      outer1[1].curveTo(borderArgs);\r\n    } else {\r\n      borderArgs.push([ \"line\", borderData.c1[0], borderData.c1[1]]);\r\n    }\r\n\r\n    if (radius2[0] > 0 || radius2[1] > 0) {\r\n      borderArgs.push([\"line\", outer2[0].start.x, outer2[0].start.y]);\r\n      outer2[0].curveTo(borderArgs);\r\n      borderArgs.push([\"line\", inner2[0].end.x, inner2[0].end.y]);\r\n      inner2[0].curveToReversed(borderArgs);\r\n    } else {\r\n      borderArgs.push([ \"line\", borderData.c2[0], borderData.c2[1]]);\r\n      borderArgs.push([ \"line\", borderData.c3[0], borderData.c3[1]]);\r\n    }\r\n\r\n    if (radius1[0] > 0 || radius1[1] > 0) {\r\n      borderArgs.push([\"line\", inner1[1].end.x, inner1[1].end.y]);\r\n      inner1[1].curveToReversed(borderArgs);\r\n    } else {\r\n      borderArgs.push([ \"line\", borderData.c4[0], borderData.c4[1]]);\r\n    }\r\n\r\n    return borderArgs;\r\n  }\r\n\r\n  function calculateCurvePoints(bounds, borderRadius, borders) {\r\n\r\n    var x = bounds.left,\r\n    y = bounds.top,\r\n    width = bounds.width,\r\n    height = bounds.height,\r\n\r\n    tlh = borderRadius[0][0],\r\n    tlv = borderRadius[0][1],\r\n    trh = borderRadius[1][0],\r\n    trv = borderRadius[1][1],\r\n    brv = borderRadius[2][0],\r\n    brh = borderRadius[2][1],\r\n    blh = borderRadius[3][0],\r\n    blv = borderRadius[3][1],\r\n\r\n    topWidth = width - trh,\r\n    rightHeight = height - brv,\r\n    bottomWidth = width - brh,\r\n    leftHeight = height - blv;\r\n\r\n    return {\r\n      topLeftOuter: getCurvePoints(\r\n        x,\r\n        y,\r\n        tlh,\r\n        tlv\r\n        ).topLeft.subdivide(0.5),\r\n\r\n      topLeftInner: getCurvePoints(\r\n        x + borders[3].width,\r\n        y + borders[0].width,\r\n        Math.max(0, tlh - borders[3].width),\r\n        Math.max(0, tlv - borders[0].width)\r\n        ).topLeft.subdivide(0.5),\r\n\r\n      topRightOuter: getCurvePoints(\r\n        x + topWidth,\r\n        y,\r\n        trh,\r\n        trv\r\n        ).topRight.subdivide(0.5),\r\n\r\n      topRightInner: getCurvePoints(\r\n        x + Math.min(topWidth, width + borders[3].width),\r\n        y + borders[0].width,\r\n        (topWidth > width + borders[3].width) ? 0 :trh - borders[3].width,\r\n        trv - borders[0].width\r\n        ).topRight.subdivide(0.5),\r\n\r\n      bottomRightOuter: getCurvePoints(\r\n        x + bottomWidth,\r\n        y + rightHeight,\r\n        brh,\r\n        brv\r\n        ).bottomRight.subdivide(0.5),\r\n\r\n      bottomRightInner: getCurvePoints(\r\n        x + Math.min(bottomWidth, width + borders[3].width),\r\n        y + Math.min(rightHeight, height + borders[0].width),\r\n        Math.max(0, brh - borders[1].width),\r\n        Math.max(0, brv - borders[2].width)\r\n        ).bottomRight.subdivide(0.5),\r\n\r\n      bottomLeftOuter: getCurvePoints(\r\n        x,\r\n        y + leftHeight,\r\n        blh,\r\n        blv\r\n        ).bottomLeft.subdivide(0.5),\r\n\r\n      bottomLeftInner: getCurvePoints(\r\n        x + borders[3].width,\r\n        y + leftHeight,\r\n        Math.max(0, blh - borders[3].width),\r\n        Math.max(0, blv - borders[2].width)\r\n        ).bottomLeft.subdivide(0.5)\r\n    };\r\n  }\r\n\r\n  function getBorderClip(element, borderPoints, borders, radius, bounds) {\r\n    var backgroundClip = getCSS(element, 'backgroundClip'),\r\n    borderArgs = [];\r\n\r\n    switch(backgroundClip) {\r\n      case \"content-box\":\r\n      case \"padding-box\":\r\n        parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftInner, borderPoints.topRightInner, bounds.left + borders[3].width, bounds.top + borders[0].width);\r\n        parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightInner, borderPoints.bottomRightInner, bounds.left + bounds.width - borders[1].width, bounds.top + borders[0].width);\r\n        parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightInner, borderPoints.bottomLeftInner, bounds.left + bounds.width - borders[1].width, bounds.top + bounds.height - borders[2].width);\r\n        parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftInner, borderPoints.topLeftInner, bounds.left + borders[3].width, bounds.top + bounds.height - borders[2].width);\r\n        break;\r\n\r\n      default:\r\n        parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftOuter, borderPoints.topRightOuter, bounds.left, bounds.top);\r\n        parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightOuter, borderPoints.bottomRightOuter, bounds.left + bounds.width, bounds.top);\r\n        parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightOuter, borderPoints.bottomLeftOuter, bounds.left + bounds.width, bounds.top + bounds.height);\r\n        parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftOuter, borderPoints.topLeftOuter, bounds.left, bounds.top + bounds.height);\r\n        break;\r\n    }\r\n\r\n    return borderArgs;\r\n  }\r\n\r\n  function parseBorders(element, bounds, borders){\r\n    var x = bounds.left,\r\n    y = bounds.top,\r\n    width = bounds.width,\r\n    height = bounds.height,\r\n    borderSide,\r\n    bx,\r\n    by,\r\n    bw,\r\n    bh,\r\n    borderArgs,\r\n    // http://www.w3.org/TR/css3-background/#the-border-radius\r\n    borderRadius = getBorderRadiusData(element),\r\n    borderPoints = calculateCurvePoints(bounds, borderRadius, borders),\r\n    borderData = {\r\n      clip: getBorderClip(element, borderPoints, borders, borderRadius, bounds),\r\n      borders: []\r\n    };\r\n\r\n    for (borderSide = 0; borderSide < 4; borderSide++) {\r\n\r\n      if (borders[borderSide].width > 0) {\r\n        bx = x;\r\n        by = y;\r\n        bw = width;\r\n        bh = height - (borders[2].width);\r\n\r\n        switch(borderSide) {\r\n          case 0:\r\n            // top border\r\n            bh = borders[0].width;\r\n\r\n            borderArgs = drawSide({\r\n              c1: [bx, by],\r\n              c2: [bx + bw, by],\r\n              c3: [bx + bw - borders[1].width, by + bh],\r\n              c4: [bx + borders[3].width, by + bh]\r\n            }, borderRadius[0], borderRadius[1],\r\n            borderPoints.topLeftOuter, borderPoints.topLeftInner, borderPoints.topRightOuter, borderPoints.topRightInner);\r\n            break;\r\n          case 1:\r\n            // right border\r\n            bx = x + width - (borders[1].width);\r\n            bw = borders[1].width;\r\n\r\n            borderArgs = drawSide({\r\n              c1: [bx + bw, by],\r\n              c2: [bx + bw, by + bh + borders[2].width],\r\n              c3: [bx, by + bh],\r\n              c4: [bx, by + borders[0].width]\r\n            }, borderRadius[1], borderRadius[2],\r\n            borderPoints.topRightOuter, borderPoints.topRightInner, borderPoints.bottomRightOuter, borderPoints.bottomRightInner);\r\n            break;\r\n          case 2:\r\n            // bottom border\r\n            by = (by + height) - (borders[2].width);\r\n            bh = borders[2].width;\r\n\r\n            borderArgs = drawSide({\r\n              c1: [bx + bw, by + bh],\r\n              c2: [bx, by + bh],\r\n              c3: [bx + borders[3].width, by],\r\n              c4: [bx + bw - borders[2].width, by]\r\n            }, borderRadius[2], borderRadius[3],\r\n            borderPoints.bottomRightOuter, borderPoints.bottomRightInner, borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner);\r\n            break;\r\n          case 3:\r\n            // left border\r\n            bw = borders[3].width;\r\n\r\n            borderArgs = drawSide({\r\n              c1: [bx, by + bh + borders[2].width],\r\n              c2: [bx, by],\r\n              c3: [bx + bw, by + borders[0].width],\r\n              c4: [bx + bw, by + bh]\r\n            }, borderRadius[3], borderRadius[0],\r\n            borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner, borderPoints.topLeftOuter, borderPoints.topLeftInner);\r\n            break;\r\n        }\r\n\r\n        borderData.borders.push({\r\n          args: borderArgs,\r\n          color: borders[borderSide].color\r\n        });\r\n\r\n      }\r\n    }\r\n\r\n    return borderData;\r\n  }\r\n\r\n  function createShape(ctx, args) {\r\n    var shape = ctx.drawShape();\r\n    args.forEach(function(border, index) {\r\n      shape[(index === 0) ? \"moveTo\" : border[0] + \"To\" ].apply(null, border.slice(1));\r\n    });\r\n    return shape;\r\n  }\r\n\r\n  function renderBorders(ctx, borderArgs, color) {\r\n    if (color !== \"transparent\") {\r\n      ctx.setVariable( \"fillStyle\", color);\r\n      createShape(ctx, borderArgs);\r\n      ctx.fill();\r\n      numDraws+=1;\r\n    }\r\n  }\r\n\r\n  function renderFormValue (el, bounds, stack){\r\n\r\n    var valueWrap = doc.createElement('valuewrap'),\r\n    cssPropertyArray = ['lineHeight','textAlign','fontFamily','color','fontSize','paddingLeft','paddingTop','width','height','border','borderLeftWidth','borderTopWidth'],\r\n    textValue,\r\n    textNode;\r\n\r\n    cssPropertyArray.forEach(function(property) {\r\n      try {\r\n        valueWrap.style[property] = getCSS(el, property);\r\n      } catch(e) {\r\n        // Older IE has issues with \"border\"\r\n        h2clog(\"html2canvas: Parse: Exception caught in renderFormValue: \" + e.message);\r\n      }\r\n    });\r\n\r\n    valueWrap.style.borderColor = \"black\";\r\n    valueWrap.style.borderStyle = \"solid\";\r\n    valueWrap.style.display = \"block\";\r\n    valueWrap.style.position = \"absolute\";\r\n\r\n    if (/^(submit|reset|button|text|password)$/.test(el.type) || el.nodeName === \"SELECT\"){\r\n      valueWrap.style.lineHeight = getCSS(el, \"height\");\r\n    }\r\n\r\n    valueWrap.style.top = bounds.top + \"px\";\r\n    valueWrap.style.left = bounds.left + \"px\";\r\n\r\n    textValue = (el.nodeName === \"SELECT\") ? (el.options[el.selectedIndex] || 0).text : el.value;\r\n    if(!textValue) {\r\n      textValue = el.placeholder;\r\n    }\r\n\r\n    textNode = doc.createTextNode(textValue);\r\n\r\n    valueWrap.appendChild(textNode);\r\n    body.appendChild(valueWrap);\r\n\r\n    renderText(el, textNode, stack);\r\n    body.removeChild(valueWrap);\r\n  }\r\n\r\n  function drawImage (ctx) {\r\n    ctx.drawImage.apply(ctx, Array.prototype.slice.call(arguments, 1));\r\n    numDraws+=1;\r\n  }\r\n\r\n  function getPseudoElement(el, which) {\r\n    var elStyle = window.getComputedStyle(el, which);\r\n    if(!elStyle || !elStyle.content || elStyle.content === \"none\" || elStyle.content === \"-moz-alt-content\") {\r\n      return;\r\n    }\r\n    var content = elStyle.content + '',\r\n    first = content.substr( 0, 1 );\r\n    //strips quotes\r\n    if(first === content.substr( content.length - 1 ) && first.match(/'|\"/)) {\r\n      content = content.substr( 1, content.length - 2 );\r\n    }\r\n\r\n    var isImage = content.substr( 0, 3 ) === 'url',\r\n    elps = document.createElement( isImage ? 'img' : 'span' );\r\n\r\n    elps.className = pseudoHide + \"-before \" + pseudoHide + \"-after\";\r\n\r\n    Object.keys(elStyle).filter(indexedProperty).forEach(function(prop) {\r\n      // Prevent assigning of read only CSS Rules, ex. length, parentRule\r\n      try {\r\n        elps.style[prop] = elStyle[prop];\r\n      } catch (e) {\r\n        h2clog(['Tried to assign readonly property ', prop, 'Error:', e]);\r\n      }\r\n    });\r\n\r\n    if(isImage) {\r\n      elps.src = _html2canvas.Util.parseBackgroundImage(content)[0].args[0];\r\n    } else {\r\n      elps.innerHTML = content;\r\n    }\r\n    return elps;\r\n  }\r\n\r\n  function indexedProperty(property) {\r\n    return (isNaN(window.parseInt(property, 10)));\r\n  }\r\n\r\n  function injectPseudoElements(el, stack) {\r\n    var before = getPseudoElement(el, ':before'),\r\n    after = getPseudoElement(el, ':after');\r\n    if(!before && !after) {\r\n      return;\r\n    }\r\n\r\n    if(before) {\r\n      el.className += \" \" + pseudoHide + \"-before\";\r\n      el.parentNode.insertBefore(before, el);\r\n      parseElement(before, stack, true);\r\n      el.parentNode.removeChild(before);\r\n      el.className = el.className.replace(pseudoHide + \"-before\", \"\").trim();\r\n    }\r\n\r\n    if (after) {\r\n      el.className += \" \" + pseudoHide + \"-after\";\r\n      el.appendChild(after);\r\n      parseElement(after, stack, true);\r\n      el.removeChild(after);\r\n      el.className = el.className.replace(pseudoHide + \"-after\", \"\").trim();\r\n    }\r\n\r\n  }\r\n\r\n  function renderBackgroundRepeat(ctx, image, backgroundPosition, bounds) {\r\n    var offsetX = Math.round(bounds.left + backgroundPosition.left),\r\n    offsetY = Math.round(bounds.top + backgroundPosition.top);\r\n\r\n    ctx.createPattern(image);\r\n    ctx.translate(offsetX, offsetY);\r\n    ctx.fill();\r\n    ctx.translate(-offsetX, -offsetY);\r\n  }\r\n\r\n  function backgroundRepeatShape(ctx, image, backgroundPosition, bounds, left, top, width, height) {\r\n    var args = [];\r\n    args.push([\"line\", Math.round(left), Math.round(top)]);\r\n    args.push([\"line\", Math.round(left + width), Math.round(top)]);\r\n    args.push([\"line\", Math.round(left + width), Math.round(height + top)]);\r\n    args.push([\"line\", Math.round(left), Math.round(height + top)]);\r\n    createShape(ctx, args);\r\n    ctx.save();\r\n    ctx.clip();\r\n    renderBackgroundRepeat(ctx, image, backgroundPosition, bounds);\r\n    ctx.restore();\r\n  }\r\n\r\n  function renderBackgroundColor(ctx, backgroundBounds, bgcolor) {\r\n    renderRect(\r\n      ctx,\r\n      backgroundBounds.left,\r\n      backgroundBounds.top,\r\n      backgroundBounds.width,\r\n      backgroundBounds.height,\r\n      bgcolor\r\n      );\r\n  }\r\n\r\n  function renderBackgroundRepeating(el, bounds, ctx, image, imageIndex) {\r\n    var backgroundSize = _html2canvas.Util.BackgroundSize(el, bounds, image, imageIndex),\r\n    backgroundPosition = _html2canvas.Util.BackgroundPosition(el, bounds, image, imageIndex, backgroundSize),\r\n    backgroundRepeat = getCSS(el, \"backgroundRepeat\").split(\",\").map(function(value) {\r\n      return value.trim();\r\n    });\r\n\r\n    image = resizeImage(image, backgroundSize);\r\n\r\n    backgroundRepeat = backgroundRepeat[imageIndex] || backgroundRepeat[0];\r\n\r\n    switch (backgroundRepeat) {\r\n      case \"repeat-x\":\r\n        backgroundRepeatShape(ctx, image, backgroundPosition, bounds,\r\n          bounds.left, bounds.top + backgroundPosition.top, 99999, image.height);\r\n        break;\r\n\r\n      case \"repeat-y\":\r\n        backgroundRepeatShape(ctx, image, backgroundPosition, bounds,\r\n          bounds.left + backgroundPosition.left, bounds.top, image.width, 99999);\r\n        break;\r\n\r\n      case \"no-repeat\":\r\n        backgroundRepeatShape(ctx, image, backgroundPosition, bounds,\r\n          bounds.left + backgroundPosition.left, bounds.top + backgroundPosition.top, image.width, image.height);\r\n        break;\r\n\r\n      default:\r\n        renderBackgroundRepeat(ctx, image, backgroundPosition, {\r\n          top: bounds.top,\r\n          left: bounds.left,\r\n          width: image.width,\r\n          height: image.height\r\n        });\r\n        break;\r\n    }\r\n  }\r\n\r\n  function renderBackgroundImage(element, bounds, ctx) {\r\n    var backgroundImage = getCSS(element, \"backgroundImage\"),\r\n    backgroundImages = _html2canvas.Util.parseBackgroundImage(backgroundImage),\r\n    image,\r\n    imageIndex = backgroundImages.length;\r\n\r\n    while(imageIndex--) {\r\n      backgroundImage = backgroundImages[imageIndex];\r\n\r\n      if (!backgroundImage.args || backgroundImage.args.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      var key = backgroundImage.method === 'url' ?\r\n      backgroundImage.args[0] :\r\n      backgroundImage.value;\r\n\r\n      image = loadImage(key);\r\n\r\n      // TODO add support for background-origin\r\n      if (image) {\r\n        renderBackgroundRepeating(element, bounds, ctx, image, imageIndex);\r\n      } else {\r\n        h2clog(\"html2canvas: Error loading background:\", backgroundImage);\r\n      }\r\n    }\r\n  }\r\n\r\n  function resizeImage(image, bounds) {\r\n    if(image.width === bounds.width && image.height === bounds.height) {\r\n      return image;\r\n    }\r\n\r\n    var ctx, canvas = doc.createElement('canvas');\r\n    canvas.width = bounds.width;\r\n    canvas.height = bounds.height;\r\n    ctx = canvas.getContext(\"2d\");\r\n    drawImage(ctx, image, 0, 0, image.width, image.height, 0, 0, bounds.width, bounds.height );\r\n    return canvas;\r\n  }\r\n\r\n  function setOpacity(ctx, element, parentStack) {\r\n    var opacity = getCSS(element, \"opacity\") * ((parentStack) ? parentStack.opacity : 1);\r\n    ctx.setVariable(\"globalAlpha\", opacity);\r\n    return opacity;\r\n  }\r\n\r\n  function createStack(element, parentStack, bounds) {\r\n\r\n    var ctx = h2cRenderContext((!parentStack) ? documentWidth() : bounds.width , (!parentStack) ? documentHeight() : bounds.height),\r\n    stack = {\r\n      ctx: ctx,\r\n      zIndex: setZ(getCSS(element, \"zIndex\"), (parentStack) ? parentStack.zIndex : null),\r\n      opacity: setOpacity(ctx, element, parentStack),\r\n      cssPosition: getCSS(element, \"position\"),\r\n      borders: getBorderData(element),\r\n      clip: (parentStack && parentStack.clip) ? _html2canvas.Util.Extend( {}, parentStack.clip ) : null\r\n    };\r\n\r\n    // TODO correct overflow for absolute content residing under a static position\r\n    if (options.useOverflow === true && /(hidden|scroll|auto)/.test(getCSS(element, \"overflow\")) === true && /(BODY)/i.test(element.nodeName) === false){\r\n      stack.clip = (stack.clip) ? clipBounds(stack.clip, bounds) : bounds;\r\n    }\r\n\r\n    stack.zIndex.children.push(stack);\r\n\r\n    return stack;\r\n  }\r\n\r\n  function getBackgroundBounds(borders, bounds, clip) {\r\n    var backgroundBounds = {\r\n      left: bounds.left + borders[3].width,\r\n      top: bounds.top + borders[0].width,\r\n      width: bounds.width - (borders[1].width + borders[3].width),\r\n      height: bounds.height - (borders[0].width + borders[2].width)\r\n    };\r\n\r\n    if (clip) {\r\n      backgroundBounds = clipBounds(backgroundBounds, clip);\r\n    }\r\n\r\n    return backgroundBounds;\r\n  }\r\n\r\n  function renderElement(element, parentStack, pseudoElement){\r\n    var bounds = _html2canvas.Util.Bounds(element),\r\n    image,\r\n    bgcolor = (ignoreElementsRegExp.test(element.nodeName)) ? \"#efefef\" : getCSS(element, \"backgroundColor\"),\r\n    stack = createStack(element, parentStack, bounds),\r\n    borders = stack.borders,\r\n    ctx = stack.ctx,\r\n    backgroundBounds = getBackgroundBounds(borders, bounds, stack.clip),\r\n    borderData = parseBorders(element, bounds, borders);\r\n\r\n    createShape(ctx, borderData.clip);\r\n\r\n    ctx.save();\r\n    ctx.clip();\r\n\r\n    if (backgroundBounds.height > 0 && backgroundBounds.width > 0){\r\n      renderBackgroundColor(ctx, bounds, bgcolor);\r\n      renderBackgroundImage(element, backgroundBounds, ctx);\r\n    }\r\n\r\n    ctx.restore();\r\n\r\n    borderData.borders.forEach(function(border) {\r\n      renderBorders(ctx, border.args, border.color);\r\n    });\r\n\r\n    if (!pseudoElement) {\r\n      injectPseudoElements(element, stack);\r\n    }\r\n\r\n    switch(element.nodeName){\r\n      case \"IMG\":\r\n        if ((image = loadImage(element.getAttribute('src')))) {\r\n          renderImage(ctx, element, image, bounds, borders);\r\n        } else {\r\n          h2clog(\"html2canvas: Error loading <img>:\" + element.getAttribute('src'));\r\n        }\r\n        break;\r\n      case \"INPUT\":\r\n        // TODO add all relevant type's, i.e. HTML5 new stuff\r\n        // todo add support for placeholder attribute for browsers which support it\r\n        if (/^(text|url|email|submit|button|reset)$/.test(element.type) && (element.value || element.placeholder).length > 0){\r\n          renderFormValue(element, bounds, stack);\r\n        }\r\n        break;\r\n      case \"TEXTAREA\":\r\n        if ((element.value || element.placeholder || \"\").length > 0){\r\n          renderFormValue(element, bounds, stack);\r\n        }\r\n        break;\r\n      case \"SELECT\":\r\n        if ((element.options||element.placeholder || \"\").length > 0){\r\n          renderFormValue(element, bounds, stack);\r\n        }\r\n        break;\r\n      case \"LI\":\r\n        renderListItem(element, stack, backgroundBounds);\r\n        break;\r\n      case \"CANVAS\":\r\n        renderImage(ctx, element, element, bounds, borders);\r\n        break;\r\n    }\r\n\r\n    return stack;\r\n  }\r\n\r\n  function isElementVisible(element) {\r\n    return (getCSS(element, 'display') !== \"none\" && getCSS(element, 'visibility') !== \"hidden\" && !element.hasAttribute(\"data-html2canvas-ignore\"));\r\n  }\r\n\r\n  function parseElement (el, stack, pseudoElement) {\r\n\r\n    if (isElementVisible(el)) {\r\n      stack = renderElement(el, stack, pseudoElement) || stack;\r\n      if (!ignoreElementsRegExp.test(el.nodeName)) {\r\n        _html2canvas.Util.Children(el).forEach(function(node) {\r\n          if (node.nodeType === 1) {\r\n            parseElement(node, stack, pseudoElement);\r\n          } else if (node.nodeType === 3) {\r\n            renderText(el, node, stack);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  function svgDOMRender(body, stack) {\r\n    var img = new Image(),\r\n    docWidth = documentWidth(),\r\n    docHeight = documentHeight(),\r\n    html = \"\";\r\n\r\n    function parseDOM(el) {\r\n      var children = _html2canvas.Util.Children( el ),\r\n      len = children.length,\r\n      attr,\r\n      a,\r\n      alen,\r\n      elm,\r\n      i;\r\n      for ( i = 0; i < len; i+=1 ) {\r\n        elm = children[ i ];\r\n        if ( elm.nodeType === 3 ) {\r\n          // Text node\r\n          html += elm.nodeValue.replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\");\r\n        } else if ( elm.nodeType === 1 ) {\r\n          // Element\r\n          if ( !/^(script|meta|title)$/.test(elm.nodeName.toLowerCase()) ) {\r\n\r\n            html += \"<\" + elm.nodeName.toLowerCase();\r\n\r\n            // add attributes\r\n            if ( elm.hasAttributes() ) {\r\n              attr = elm.attributes;\r\n              alen = attr.length;\r\n              for ( a = 0; a < alen; a+=1 ) {\r\n                html += \" \" + attr[ a ].name + '=\"' + attr[ a ].value + '\"';\r\n              }\r\n            }\r\n\r\n\r\n            html += '>';\r\n\r\n            parseDOM( elm );\r\n\r\n\r\n            html += \"</\" + elm.nodeName.toLowerCase() + \">\";\r\n          }\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    parseDOM(body);\r\n    img.src = [\r\n    \"data:image/svg+xml,\",\r\n    \"<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='\" + docWidth + \"' height='\" + docHeight + \"'>\",\r\n    \"<foreignObject width='\" + docWidth + \"' height='\" + docHeight + \"'>\",\r\n    \"<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>\",\r\n    html.replace(/\\#/g,\"%23\"),\r\n    \"</html>\",\r\n    \"</foreignObject>\",\r\n    \"</svg>\"\r\n    ].join(\"\");\r\n\r\n    img.onload = function() {\r\n      stack.svgRender = img;\r\n    };\r\n\r\n  }\r\n\r\n  function init() {\r\n    var stack = renderElement(element, null);\r\n\r\n    if (support.svgRendering) {\r\n      svgDOMRender(document.documentElement, stack);\r\n    }\r\n\r\n    Array.prototype.slice.call(element.children, 0).forEach(function(childElement) {\r\n      parseElement(childElement, stack);\r\n    });\r\n\r\n    stack.backgroundColor = getCSS(document.documentElement, \"backgroundColor\");\r\n    body.removeChild(hidePseudoElements);\r\n    return stack;\r\n  }\r\n\r\n  return init();\r\n};\r\n\r\nfunction h2czContext(zindex) {\r\n  return {\r\n    zindex: zindex,\r\n    children: []\r\n  };\r\n}\r\n_html2canvas.Preload = function( options ) {\r\n\r\n  var images = {\r\n    numLoaded: 0,   // also failed are counted here\r\n    numFailed: 0,\r\n    numTotal: 0,\r\n    cleanupDone: false\r\n  },\r\n  pageOrigin,\r\n  methods,\r\n  i,\r\n  count = 0,\r\n  element = options.elements[0] || document.body,\r\n  doc = element.ownerDocument,\r\n  domImages = doc.images, // TODO probably should limit it to images present in the element only\r\n  imgLen = domImages.length,\r\n  link = doc.createElement(\"a\"),\r\n  supportCORS = (function( img ){\r\n    return (img.crossOrigin !== undefined);\r\n  })(new Image()),\r\n  timeoutTimer;\r\n\r\n  link.href = window.location.href;\r\n  pageOrigin  = link.protocol + link.host;\r\n\r\n  function isSameOrigin(url){\r\n    link.href = url;\r\n    link.href = link.href; // YES, BELIEVE IT OR NOT, that is required for IE9 - http://jsfiddle.net/niklasvh/2e48b/\r\n    var origin = link.protocol + link.host;\r\n    return (origin === pageOrigin);\r\n  }\r\n\r\n  function start(){\r\n    h2clog(\"html2canvas: start: images: \" + images.numLoaded + \" / \" + images.numTotal + \" (failed: \" + images.numFailed + \")\");\r\n    if (!images.firstRun && images.numLoaded >= images.numTotal){\r\n      h2clog(\"Finished loading images: # \" + images.numTotal + \" (failed: \" + images.numFailed + \")\");\r\n\r\n      if (typeof options.complete === \"function\"){\r\n        options.complete(images);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  // TODO modify proxy to serve images with CORS enabled, where available\r\n  function proxyGetImage(url, img, imageObj){\r\n    var callback_name,\r\n    scriptUrl = options.proxy,\r\n    script;\r\n\r\n    link.href = url;\r\n    url = link.href; // work around for pages with base href=\"\" set - WARNING: this may change the url\r\n\r\n    callback_name = 'html2canvas_' + (count++);\r\n    imageObj.callbackname = callback_name;\r\n\r\n    if (scriptUrl.indexOf(\"?\") > -1) {\r\n      scriptUrl += \"&\";\r\n    } else {\r\n      scriptUrl += \"?\";\r\n    }\r\n    scriptUrl += 'url=' + encodeURIComponent(url) + '&callback=' + callback_name;\r\n    script = doc.createElement(\"script\");\r\n\r\n    window[callback_name] = function(a){\r\n      if (a.substring(0,6) === \"error:\"){\r\n        imageObj.succeeded = false;\r\n        images.numLoaded++;\r\n        images.numFailed++;\r\n        start();\r\n      } else {\r\n        setImageLoadHandlers(img, imageObj);\r\n        img.src = a;\r\n      }\r\n      window[callback_name] = undefined; // to work with IE<9  // NOTE: that the undefined callback property-name still exists on the window object (for IE<9)\r\n      try {\r\n        delete window[callback_name];  // for all browser that support this\r\n      } catch(ex) {}\r\n      script.parentNode.removeChild(script);\r\n      script = null;\r\n      delete imageObj.script;\r\n      delete imageObj.callbackname;\r\n    };\r\n\r\n    script.setAttribute(\"type\", \"text/javascript\");\r\n    script.setAttribute(\"src\", scriptUrl);\r\n    imageObj.script = script;\r\n    window.document.body.appendChild(script);\r\n\r\n  }\r\n\r\n  function loadPseudoElement(element, type) {\r\n    var style = window.getComputedStyle(element, type),\r\n    content = style.content;\r\n    if (content.substr(0, 3) === 'url') {\r\n      methods.loadImage(_html2canvas.Util.parseBackgroundImage(content)[0].args[0]);\r\n    }\r\n    loadBackgroundImages(style.backgroundImage, element);\r\n  }\r\n\r\n  function loadPseudoElementImages(element) {\r\n    loadPseudoElement(element, \":before\");\r\n    loadPseudoElement(element, \":after\");\r\n  }\r\n\r\n  function loadGradientImage(backgroundImage, bounds) {\r\n    var img = _html2canvas.Generate.Gradient(backgroundImage, bounds);\r\n\r\n    if (img !== undefined){\r\n      images[backgroundImage] = {\r\n        img: img,\r\n        succeeded: true\r\n      };\r\n      images.numTotal++;\r\n      images.numLoaded++;\r\n      start();\r\n    }\r\n  }\r\n\r\n  function invalidBackgrounds(background_image) {\r\n    return (background_image && background_image.method && background_image.args && background_image.args.length > 0 );\r\n  }\r\n\r\n  function loadBackgroundImages(background_image, el) {\r\n    var bounds;\r\n\r\n    _html2canvas.Util.parseBackgroundImage(background_image).filter(invalidBackgrounds).forEach(function(background_image) {\r\n      if (background_image.method === 'url') {\r\n        methods.loadImage(background_image.args[0]);\r\n      } else if(background_image.method.match(/\\-?gradient$/)) {\r\n        if(bounds === undefined) {\r\n          bounds = _html2canvas.Util.Bounds(el);\r\n        }\r\n        loadGradientImage(background_image.value, bounds);\r\n      }\r\n    });\r\n  }\r\n\r\n  function getImages (el) {\r\n    var elNodeType = false;\r\n\r\n    // Firefox fails with permission denied on pages with iframes\r\n    try {\r\n      _html2canvas.Util.Children(el).forEach(function(img) {\r\n        getImages(img);\r\n      });\r\n    }\r\n    catch( e ) {}\r\n\r\n    try {\r\n      elNodeType = el.nodeType;\r\n    } catch (ex) {\r\n      elNodeType = false;\r\n      h2clog(\"html2canvas: failed to access some element's nodeType - Exception: \" + ex.message);\r\n    }\r\n\r\n    if (elNodeType === 1 || elNodeType === undefined) {\r\n      loadPseudoElementImages(el);\r\n      try {\r\n        loadBackgroundImages(_html2canvas.Util.getCSS(el, 'backgroundImage'), el);\r\n      } catch(e) {\r\n        h2clog(\"html2canvas: failed to get background-image - Exception: \" + e.message);\r\n      }\r\n      loadBackgroundImages(el);\r\n    }\r\n  }\r\n\r\n  function setImageLoadHandlers(img, imageObj) {\r\n    img.onload = function() {\r\n      if ( imageObj.timer !== undefined ) {\r\n        // CORS succeeded\r\n        window.clearTimeout( imageObj.timer );\r\n      }\r\n\r\n      images.numLoaded++;\r\n      imageObj.succeeded = true;\r\n      img.onerror = img.onload = null;\r\n      start();\r\n    };\r\n    img.onerror = function() {\r\n      if (img.crossOrigin === \"anonymous\") {\r\n        // CORS failed\r\n        window.clearTimeout( imageObj.timer );\r\n\r\n        // let's try with proxy instead\r\n        if ( options.proxy ) {\r\n          var src = img.src;\r\n          img = new Image();\r\n          imageObj.img = img;\r\n          img.src = src;\r\n\r\n          proxyGetImage( img.src, img, imageObj );\r\n          return;\r\n        }\r\n      }\r\n\r\n      images.numLoaded++;\r\n      images.numFailed++;\r\n      imageObj.succeeded = false;\r\n      img.onerror = img.onload = null;\r\n      start();\r\n    };\r\n  }\r\n\r\n  methods = {\r\n    loadImage: function( src ) {\r\n      var img, imageObj;\r\n      if ( src && images[src] === undefined ) {\r\n        img = new Image();\r\n        if ( src.match(/data:image\\/.*;base64,/i) ) {\r\n          img.src = src.replace(/url\\(['\"]{0,}|['\"]{0,}\\)$/ig, '');\r\n          imageObj = images[src] = {\r\n            img: img\r\n          };\r\n          images.numTotal++;\r\n          setImageLoadHandlers(img, imageObj);\r\n        } else if ( isSameOrigin( src ) || options.allowTaint ===  true ) {\r\n          imageObj = images[src] = {\r\n            img: img\r\n          };\r\n          images.numTotal++;\r\n          setImageLoadHandlers(img, imageObj);\r\n          img.src = src;\r\n        } else if ( supportCORS && !options.allowTaint && options.useCORS ) {\r\n          // attempt to load with CORS\r\n\r\n          img.crossOrigin = \"anonymous\";\r\n          imageObj = images[src] = {\r\n            img: img\r\n          };\r\n          images.numTotal++;\r\n          setImageLoadHandlers(img, imageObj);\r\n          img.src = src;\r\n\r\n          // work around for https://bugs.webkit.org/show_bug.cgi?id=80028\r\n          img.customComplete = function () {\r\n            if (!this.img.complete) {\r\n              this.timer = window.setTimeout(this.img.customComplete, 100);\r\n            } else {\r\n              this.img.onerror();\r\n            }\r\n          }.bind(imageObj);\r\n          img.customComplete();\r\n\r\n        } else if ( options.proxy ) {\r\n          imageObj = images[src] = {\r\n            img: img\r\n          };\r\n          images.numTotal++;\r\n          proxyGetImage( src, img, imageObj );\r\n        }\r\n      }\r\n\r\n    },\r\n    cleanupDOM: function(cause) {\r\n      var img, src;\r\n      if (!images.cleanupDone) {\r\n        if (cause && typeof cause === \"string\") {\r\n          h2clog(\"html2canvas: Cleanup because: \" + cause);\r\n        } else {\r\n          h2clog(\"html2canvas: Cleanup after timeout: \" + options.timeout + \" ms.\");\r\n        }\r\n\r\n        for (src in images) {\r\n          if (images.hasOwnProperty(src)) {\r\n            img = images[src];\r\n            if (typeof img === \"object\" && img.callbackname && img.succeeded === undefined) {\r\n              // cancel proxy image request\r\n              window[img.callbackname] = undefined; // to work with IE<9  // NOTE: that the undefined callback property-name still exists on the window object (for IE<9)\r\n              try {\r\n                delete window[img.callbackname];  // for all browser that support this\r\n              } catch(ex) {}\r\n              if (img.script && img.script.parentNode) {\r\n                img.script.setAttribute(\"src\", \"about:blank\");  // try to cancel running request\r\n                img.script.parentNode.removeChild(img.script);\r\n              }\r\n              images.numLoaded++;\r\n              images.numFailed++;\r\n              h2clog(\"html2canvas: Cleaned up failed img: '\" + src + \"' Steps: \" + images.numLoaded + \" / \" + images.numTotal);\r\n            }\r\n          }\r\n        }\r\n\r\n        // cancel any pending requests\r\n        if(window.stop !== undefined) {\r\n          window.stop();\r\n        } else if(document.execCommand !== undefined) {\r\n          document.execCommand(\"Stop\", false);\r\n        }\r\n        if (document.close !== undefined) {\r\n          document.close();\r\n        }\r\n        images.cleanupDone = true;\r\n        if (!(cause && typeof cause === \"string\")) {\r\n          start();\r\n        }\r\n      }\r\n    },\r\n\r\n    renderingDone: function() {\r\n      if (timeoutTimer) {\r\n        window.clearTimeout(timeoutTimer);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (options.timeout > 0) {\r\n    timeoutTimer = window.setTimeout(methods.cleanupDOM, options.timeout);\r\n  }\r\n\r\n  h2clog('html2canvas: Preload starts: finding background-images');\r\n  images.firstRun = true;\r\n\r\n  getImages(element);\r\n\r\n  h2clog('html2canvas: Preload: Finding images');\r\n  // load <img> images\r\n  for (i = 0; i < imgLen; i+=1){\r\n    methods.loadImage( domImages[i].getAttribute( \"src\" ) );\r\n  }\r\n\r\n  images.firstRun = false;\r\n  h2clog('html2canvas: Preload: Done.');\r\n  if ( images.numTotal === images.numLoaded ) {\r\n    start();\r\n  }\r\n\r\n  return methods;\r\n\r\n};\r\n_html2canvas.Renderer = function(parseQueue, options){\r\n\r\n  function createRenderQueue(parseQueue) {\r\n    var queue = [];\r\n\r\n    var sortZ = function(zStack){\r\n      var subStacks = [],\r\n      stackValues = [];\r\n\r\n      zStack.children.forEach(function(stackChild) {\r\n        if (stackChild.children && stackChild.children.length > 0){\r\n          subStacks.push(stackChild);\r\n          stackValues.push(stackChild.zindex);\r\n        } else {\r\n          queue.push(stackChild);\r\n        }\r\n      });\r\n\r\n      stackValues.sort(function(a, b) {\r\n        return a - b;\r\n      });\r\n\r\n      stackValues.forEach(function(zValue) {\r\n        var index;\r\n\r\n        subStacks.some(function(stack, i){\r\n          index = i;\r\n          return (stack.zindex === zValue);\r\n        });\r\n        sortZ(subStacks.splice(index, 1)[0]);\r\n\r\n      });\r\n    };\r\n\r\n    sortZ(parseQueue.zIndex);\r\n\r\n    return queue;\r\n  }\r\n\r\n  function getRenderer(rendererName) {\r\n    var renderer;\r\n\r\n    if (typeof options.renderer === \"string\" && _html2canvas.Renderer[rendererName] !== undefined) {\r\n      renderer = _html2canvas.Renderer[rendererName](options);\r\n    } else if (typeof rendererName === \"function\") {\r\n      renderer = rendererName(options);\r\n    } else {\r\n      throw new Error(\"Unknown renderer\");\r\n    }\r\n\r\n    if ( typeof renderer !== \"function\" ) {\r\n      throw new Error(\"Invalid renderer defined\");\r\n    }\r\n    return renderer;\r\n  }\r\n\r\n  return getRenderer(options.renderer)(parseQueue, options, document, createRenderQueue(parseQueue), _html2canvas);\r\n};\r\n\r\n_html2canvas.Util.Support = function (options, doc) {\r\n\r\n  function supportSVGRendering() {\r\n    var img = new Image(),\r\n    canvas = doc.createElement(\"canvas\"),\r\n    ctx = (canvas.getContext === undefined) ? false : canvas.getContext(\"2d\");\r\n    if (ctx === false) {\r\n      return false;\r\n    }\r\n    canvas.width = canvas.height = 10;\r\n    img.src = [\r\n    \"data:image/svg+xml,\",\r\n    \"<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>\",\r\n    \"<foreignObject width='10' height='10'>\",\r\n    \"<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>\",\r\n    \"sup\",\r\n    \"</div>\",\r\n    \"</foreignObject>\",\r\n    \"</svg>\"\r\n    ].join(\"\");\r\n    try {\r\n      ctx.drawImage(img, 0, 0);\r\n      canvas.toDataURL();\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n    h2clog('html2canvas: Parse: SVG powered rendering available');\r\n    return true;\r\n  }\r\n\r\n  // Test whether we can use ranges to measure bounding boxes\r\n  // Opera doesn't provide valid bounds.height/bottom even though it supports the method.\r\n\r\n  function supportRangeBounds() {\r\n    var r, testElement, rangeBounds, rangeHeight, support = false;\r\n\r\n    if (doc.createRange) {\r\n      r = doc.createRange();\r\n      if (r.getBoundingClientRect) {\r\n        testElement = doc.createElement('boundtest');\r\n        testElement.style.height = \"123px\";\r\n        testElement.style.display = \"block\";\r\n        doc.body.appendChild(testElement);\r\n\r\n        r.selectNode(testElement);\r\n        rangeBounds = r.getBoundingClientRect();\r\n        rangeHeight = rangeBounds.height;\r\n\r\n        if (rangeHeight === 123) {\r\n          support = true;\r\n        }\r\n        doc.body.removeChild(testElement);\r\n      }\r\n    }\r\n\r\n    return support;\r\n  }\r\n\r\n  return {\r\n    rangeBounds: supportRangeBounds(),\r\n    svgRendering: options.svgRendering && supportSVGRendering()\r\n  };\r\n};\r\nwindow.html2canvas = function(elements, opts) {\r\n  elements = (elements.length) ? elements : [elements];\r\n  var queue,\r\n  canvas,\r\n  options = {\r\n    // general\r\n    logging: false,\r\n    elements: elements,\r\n    background: \"#fff\",\r\n\r\n    // preload options\r\n    proxy: null,\r\n    timeout: 0,    // no timeout\r\n    useCORS: false, // try to load images as CORS (where available), before falling back to proxy\r\n    allowTaint: false, // whether to allow images to taint the canvas, won't need proxy if set to true\r\n\r\n    // parse options\r\n    svgRendering: false, // use svg powered rendering where available (FF11+)\r\n    ignoreElements: \"IFRAME|OBJECT|PARAM\",\r\n    useOverflow: true,\r\n    letterRendering: false,\r\n    chinese: false,\r\n\r\n    // render options\r\n\r\n    width: null,\r\n    height: null,\r\n    taintTest: true, // do a taint test with all images before applying to canvas\r\n    renderer: \"Canvas\"\r\n  };\r\n\r\n  options = _html2canvas.Util.Extend(opts, options);\r\n\r\n  _html2canvas.logging = options.logging;\r\n  options.complete = function( images ) {\r\n\r\n    if (typeof options.onpreloaded === \"function\") {\r\n      if ( options.onpreloaded( images ) === false ) {\r\n        return;\r\n      }\r\n    }\r\n    queue = _html2canvas.Parse( images, options );\r\n\r\n    if (typeof options.onparsed === \"function\") {\r\n      if ( options.onparsed( queue ) === false ) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    canvas = _html2canvas.Renderer( queue, options );\r\n\r\n    if (typeof options.onrendered === \"function\") {\r\n      options.onrendered( canvas );\r\n    }\r\n\r\n\r\n  };\r\n\r\n  // for pages without images, we still want this to be async, i.e. return methods before executing\r\n  window.setTimeout( function(){\r\n    _html2canvas.Preload( options );\r\n  }, 0 );\r\n\r\n  return {\r\n    render: function( queue, opts ) {\r\n      return _html2canvas.Renderer( queue, _html2canvas.Util.Extend(opts, options) );\r\n    },\r\n    parse: function( images, opts ) {\r\n      return _html2canvas.Parse( images, _html2canvas.Util.Extend(opts, options) );\r\n    },\r\n    preload: function( opts ) {\r\n      return _html2canvas.Preload( _html2canvas.Util.Extend(opts, options) );\r\n    },\r\n    log: h2clog\r\n  };\r\n};\r\n\r\nwindow.html2canvas.log = h2clog; // for renderers\r\nwindow.html2canvas.Renderer = {\r\n  Canvas: undefined // We are assuming this will be used\r\n};\r\n_html2canvas.Renderer.Canvas = function(options) {\r\n\r\n  options = options || {};\r\n\r\n  var doc = document,\r\n  safeImages = [],\r\n  testCanvas = document.createElement(\"canvas\"),\r\n  testctx = testCanvas.getContext(\"2d\"),\r\n  canvas = options.canvas || doc.createElement('canvas');\r\n\r\n\r\n  function createShape(ctx, args) {\r\n    ctx.beginPath();\r\n    args.forEach(function(arg) {\r\n      ctx[arg.name].apply(ctx, arg['arguments']);\r\n    });\r\n    ctx.closePath();\r\n  }\r\n\r\n  function safeImage(item) {\r\n    if (safeImages.indexOf(item['arguments'][0].src ) === -1) {\r\n      testctx.drawImage(item['arguments'][0], 0, 0);\r\n      try {\r\n        testctx.getImageData(0, 0, 1, 1);\r\n      } catch(e) {\r\n        testCanvas = doc.createElement(\"canvas\");\r\n        testctx = testCanvas.getContext(\"2d\");\r\n        return false;\r\n      }\r\n      safeImages.push(item['arguments'][0].src);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function isTransparent(backgroundColor) {\r\n    return (backgroundColor === \"transparent\" || backgroundColor === \"rgba(0, 0, 0, 0)\");\r\n  }\r\n\r\n  function renderItem(ctx, item) {\r\n    switch(item.type){\r\n      case \"variable\":\r\n        ctx[item.name] = item['arguments'];\r\n        break;\r\n      case \"function\":\r\n        if (item.name === \"createPattern\") {\r\n          if (item['arguments'][0].width > 0 && item['arguments'][0].height > 0) {\r\n            try {\r\n              ctx.fillStyle = ctx.createPattern(item['arguments'][0], \"repeat\");\r\n            }\r\n            catch(e) {\r\n              h2clog(\"html2canvas: Renderer: Error creating pattern\", e.message);\r\n            }\r\n          }\r\n        } else if (item.name === \"drawShape\") {\r\n          createShape(ctx, item['arguments']);\r\n        } else if (item.name === \"drawImage\") {\r\n          if (item['arguments'][8] > 0 && item['arguments'][7] > 0) {\r\n            if (!options.taintTest || (options.taintTest && safeImage(item))) {\r\n              ctx.drawImage.apply( ctx, item['arguments'] );\r\n            }\r\n          }\r\n        } else {\r\n          ctx[item.name].apply(ctx, item['arguments']);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  return function(zStack, options, doc, queue, _html2canvas) {\r\n\r\n    var ctx = canvas.getContext(\"2d\"),\r\n    storageContext,\r\n    i,\r\n    queueLen,\r\n    newCanvas,\r\n    bounds,\r\n    fstyle;\r\n\r\n    canvas.width = canvas.style.width =  options.width || zStack.ctx.width;\r\n    canvas.height = canvas.style.height = options.height || zStack.ctx.height;\r\n\r\n    fstyle = ctx.fillStyle;\r\n    ctx.fillStyle = (isTransparent(zStack.backgroundColor) && options.background !== undefined) ? options.background : zStack.backgroundColor;\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    ctx.fillStyle = fstyle;\r\n\r\n\r\n    if ( options.svgRendering && zStack.svgRender !== undefined ) {\r\n      // TODO: enable async rendering to support this\r\n      ctx.drawImage( zStack.svgRender, 0, 0 );\r\n    } else {\r\n      for ( i = 0, queueLen = queue.length; i < queueLen; i+=1 ) {\r\n        storageContext = queue.splice(0, 1)[0];\r\n        storageContext.canvasPosition = storageContext.canvasPosition || {};\r\n\r\n        // set common settings for canvas\r\n        ctx.textBaseline = \"bottom\";\r\n\r\n        if (storageContext.clip){\r\n          ctx.save();\r\n          ctx.beginPath();\r\n          // console.log(storageContext);\r\n          ctx.rect(storageContext.clip.left, storageContext.clip.top, storageContext.clip.width, storageContext.clip.height);\r\n          ctx.clip();\r\n        }\r\n\r\n        if (storageContext.ctx.storage) {\r\n          storageContext.ctx.storage.forEach(renderItem.bind(null, ctx));\r\n        }\r\n\r\n        if (storageContext.clip){\r\n          ctx.restore();\r\n        }\r\n      }\r\n    }\r\n\r\n    h2clog(\"html2canvas: Renderer: Canvas renderer done - returning canvas obj\");\r\n\r\n    queueLen = options.elements.length;\r\n\r\n    if (queueLen === 1) {\r\n      if (typeof options.elements[0] === \"object\" && options.elements[0].nodeName !== \"BODY\") {\r\n        // crop image to the bounds of selected (single) element\r\n        bounds = _html2canvas.Util.Bounds(options.elements[0]);\r\n        newCanvas = doc.createElement('canvas');\r\n        newCanvas.width = bounds.width;\r\n        newCanvas.height = bounds.height;\r\n        ctx = newCanvas.getContext(\"2d\");\r\n\r\n        ctx.drawImage(canvas, bounds.left, bounds.top, bounds.width, bounds.height, 0, 0, bounds.width, bounds.height);\r\n        canvas = null;\r\n        return newCanvas;\r\n      }\r\n    }\r\n\r\n    return canvas;\r\n  };\r\n};\r\n})(window,document);"]}