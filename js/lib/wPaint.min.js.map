{"version":3,"sources":["js/lib/wPaint.js"],"names":["$","Canvas","settings","elem","this","$elem","mainMenu","textMenu","undoArray","undoCurrent","undoMax","draw","canvas","ctx","canvasTemp","ctxTemp","canvasBg","ctxBg","canvasTempLeftOriginal","canvasTempTopOriginal","canvasTempLeftNew","canvasTempTopNew","textInput","MainMenu","menu","TextMenu","docked","dockOffsetLeft","dockOffsetTop","fn","wPaint","option","values","elements","each","data","clearAll","undefined","push","getImage","setImage","setBgImage","defaultSettings","length","extend","lineWidthMin","parseInt","lineWidthMax","lineWidth","fontSizeMin","fontSizeMax","fontSize","_settings","jQuery","document","createElement","getContext","html","imageBg","append","generateBg","width","height","generate","generateTemp","generateTextInput","moveTextMenu","set_mode","mode","buttonSize","outerHeight","css","split","find","wColorPicker","initColor","fillStyle","showSpeed","hideSpeed","onSelect","color","strokeStyle","image","addUndo","shapes","fontFamilyOptions","fontFamily","fontTypeBold","fontTypeItalic","fontTypeUnderline","drawDown","drawMove","drawUp","menuOffsetX","menuOffsetY","prototype","_self","attr","position","left","top","mousedown","e","preventDefault","stopPropagation","callFunc","mousemove","mouseup","bindMobile","bind","touches","event","changedTouches","first","type","simulatedEvent","createEvent","initMouseEvent","window","screenX","screenY","clientX","clientY","target","dispatchEvent","hide","textCalc","display","lineHeight","$e","canvas_offset","offset","pageX","Math","floor","pageY","inArray","func","apply","drawShapeDown","val","drawTextUp","show","drawShapeMove","xo","yo","half_line_width","abs","factor","x","y","w","h","drawShapeUp","drawImage","drawRectangleMove","beginPath","rect","closePath","stroke","fill","drawEllipseMove","ox","oy","xe","ye","xm","ym","moveTo","bezierCurveTo","drawLineMove","lineJoin","lineTo","drawPencilDown","lineCap","arc","PI","drawPencilMove","drawPencilUp","drawTextDown","focus","fontString","lines","linesNew","textInputWidth","lastj","i","ii","j","jj","substring","join","textBaseline","font","fillText","imgData","getImageData","putImageData","drawEraserDown","save","globalCompositeOperation","drawEraserMove","drawEraserUp","restore","canvasSave","ctxSave","toDataURL","myImage","Image","src","toString","clearRect","load","slice","pop","undoToggleIcons","setUndoImage","undoNext","undoPrev","iconUndo","iconRedo","hasClass","addClass","removeClass","$canvas","options","change","menuContent","item","click","menuHandle","draggable","handle","drag","stop","toLowerCase","setType","snap","snapElements","index","element","snapping","isActive","fontWeight","fontStyle","textDecoration"],"mappings":"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","file":"wPaint.min.js","sourcesContent":["/******************************************\n * Websanova.com\n *\n * Resources for web entrepreneurs\n *\n * @author          Websanova\n * @copyright       Copyright (c) 2012 Websanova.\n * @license         This wPaint jQuery plug-in is dual licensed under the MIT and GPL licenses.\n * @link            http://www.websanova.com\n * @github\t\t\thttp://github.com/websanova/wPaint\n * @version         Version 1.10.0\n *\n ******************************************/\n(function($)\n{\n\t$.fn.wPaint = function(option, settings)\n\t{\n\t\tif(typeof option === 'object')\n\t\t{\n\t\t\tsettings = option;\n\t\t}\n\t\telse if(typeof option == 'string')\n\t\t{\n\t\t\tvar values = [];\n\n\t\t\tvar elements = this.each(function()\n\t\t\t{\n\t\t\t\tvar data = $(this).data('_wPaint');\n\n\t\t\t\tif(data)\n\t\t\t\t{\n\t\t\t\t\tif(option == 'clear') { data.clearAll(); }\n\t\t\t\t\telse if(option == 'image' && settings === undefined) { values.push(data.getImage()); }\n\t\t\t\t\telse if(option == 'image' && settings !== undefined) { data.setImage(settings, true); }\n\t\t\t\t\telse if(option == 'imageBg' && settings !== undefined) { data.setBgImage(settings); }\n\t\t\t\t\telse if($.fn.wPaint.defaultSettings[option] !== undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\tif(settings !== undefined) { data.settings[option] = settings; }\n\t\t\t\t\t\telse { values.push(data.settings[option]); }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(values.length === 1) { return values[0]; }\n\t\t\tif(values.length > 0) { return values; }\n\t\t\telse { return elements; }\n\t\t}\n\n\t\t//clean up some variables\n\t\tsettings = $.extend({}, $.fn.wPaint.defaultSettings, settings || {});\n\t\tsettings.lineWidthMin = parseInt(settings.lineWidthMin);\n\t\tsettings.lineWidthMax = parseInt(settings.lineWidthMax);\n\t\tsettings.lineWidth = parseInt(settings.lineWidth);\n\t\tsettings.fontSizeMin = parseInt(settings.fontSizeMin);\n\t\tsettings.fontSizeMax = parseInt(settings.fontSizeMax);\n\t\tsettings.fontSize = parseInt(settings.fontSize);\n\t\t\n\t\treturn this.each(function()\n\t\t{\t\t\t\n\t\t\tvar $elem = $(this);\n\t\t\tvar _settings = jQuery.extend(true, {}, settings);\n\t\t\t\n\t\t\t//test for HTML5 canvas\n\t\t\tvar test = document.createElement('canvas');\n\t\t\tif(!test.getContext)\n\t\t\t{\n\t\t\t\t$elem.html(\"Browser does not support HTML5 canvas, please upgrade to a more modern browser.\");\n\t\t\t\treturn false;\t\n\t\t\t}\n\t\t\t\n\t\t\tif($elem.data('_wPaint')) return false;\n\n\t\t\tvar canvas = new Canvas(_settings, $elem);\n\t\t\tcanvas.mainMenu = new MainMenu();\n\t\t\tcanvas.textMenu = new TextMenu();\n\t\t\t\n\t\t\tif(_settings.imageBg) $elem.append(canvas.generateBg($elem.width(), $elem.height(), _settings.imageBg));\n\t\t\t$elem.append(canvas.generate($elem.width(), $elem.height()));\n\t\t\t$elem.append(canvas.generateTemp());\n\t\t\t$elem.append(canvas.generateTextInput());\n\t\t\t\n\t\t\t$('body')\n\t\t\t.append(canvas.mainMenu.generate(canvas, canvas.textMenu))\n\t\t\t.append(canvas.textMenu.generate(canvas, canvas.mainMenu));\n\n\t\t\t//init the snap on the text menu\n\t\t\tcanvas.mainMenu.moveTextMenu(canvas.mainMenu, canvas.textMenu);\n\n\t\t\t//init mode\n\t\t\tcanvas.mainMenu.set_mode(canvas.mainMenu, canvas, _settings.mode);\n\n\t\t\t//pull from css so that it is dynamic\n\t\t\tvar buttonSize = $(\"._wPaint_icon\").outerHeight(true) - (parseInt($(\"._wPaint_icon\").css('paddingTop').split('px')[0]) + parseInt($(\"._wPaint_icon\").css('paddingBottom').split('px')[0]));\n\n\t\t\tcanvas.mainMenu.menu.find(\"._wPaint_fillColorPicker\").wColorPicker({\n\t\t\t\tmode: \"click\",\n\t\t\t\tinitColor: _settings.fillStyle,\n\t\t\t\tbuttonSize: buttonSize,\n\t\t\t\tshowSpeed: 300,\n\t\t\t\thideSpeed: 300,\n\t\t\t\tonSelect: function(color){\n\t\t\t\t\tcanvas.settings.fillStyle = color;\n\t\t\t\t\tcanvas.textInput.css({color: color});\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tcanvas.mainMenu.menu.find(\"._wPaint_strokeColorPicker\").wColorPicker({\n\t\t\t\tmode: \"click\",\n\t\t\t\tinitColor: _settings.strokeStyle,\n\t\t\t\tbuttonSize: buttonSize,\n\t\t\t\tshowSpeed: 300,\n\t\t\t\thideSpeed: 300,\n\t\t\t\tonSelect: function(color){\n\t\t\t\t\tcanvas.settings.strokeStyle = color;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif(_settings.image)\n\t\t\t{\n\t\t\t\tcanvas.setImage(_settings.image, true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcanvas.addUndo();\n\t\t\t}\n\n\t\t\t$elem.data('_wPaint', canvas);\n\t\t});\n\t}\n\n\tvar shapes = ['Rectangle', 'Ellipse', 'Line', 'Text'];\n\n\t$.fn.wPaint.defaultSettings = {\n\t\tmode\t\t\t\t: 'Pencil',\t\t\t// drawing mode - Rectangle, Ellipse, Line, Pencil, Eraser\n\t\tlineWidthMin\t\t: '0', \t\t\t\t// line width min for select drop down\n\t\tlineWidthMax\t\t: '10',\t\t\t\t// line widh max for select drop down\n\t\tlineWidth\t\t\t: '2', \t\t\t\t// starting line width\n\t\tfillStyle\t\t\t: '#FFFFFF',\t\t// starting fill style\n\t\tstrokeStyle\t\t\t: '#FFFF00',\t\t// start stroke style\n\t\tfontSizeMin\t\t\t: '8',\t\t\t\t// min font size in px\n\t\tfontSizeMax\t\t\t: '20',\t\t\t\t// max font size in px\n\t\tfontSize\t\t\t: '12',\t\t\t\t// current font size for text input\n\t\tfontFamilyOptions\t: ['Arial', 'Courier', 'Times', 'Trebuchet', 'Verdana'], // available font families\n\t\tfontFamily\t\t\t: 'Arial',\t\t\t// active font family for text input\n\t\tfontTypeBold\t\t: false,\t\t\t// text input bold enable/disable\n\t\tfontTypeItalic\t\t: false,\t\t\t// text input italic enable/disable\n\t\tfontTypeUnderline\t: false,\t\t\t// text input italic enable/disable\n\t\timage\t\t\t\t: null,\t\t\t\t// preload image - base64 encoded data\n\t\timageBg\t\t\t\t: null,\t\t\t\t// preload image bg, cannot be altered but saved with image\n\t\tdrawDown\t\t\t: null,\t\t\t\t// function to call when start a draw\n\t\tdrawMove\t\t\t: null,\t\t\t\t// function to call during a draw\n\t\tdrawUp\t\t\t\t: null,\t\t\t\t// function to call at end of draw\n\t\tmenu \t\t\t\t: ['undo','clear','rectangle','ellipse','line','pencil','text','eraser','fillColor','lineWidth','strokeColor'], // menu items - appear in order they are set\n\t\tmenuOffsetX\t\t\t: 5,\t\t\t\t// offset for menu (left)\n\t\tmenuOffsetY\t\t\t: 5\t\t\t\t\t// offset for menu (top)\n\t};\n\n\t/**\n\t * Canvas class definition\n\t */\n\tfunction Canvas(settings, elem)\n\t{\n\t\tthis.settings = settings;\n\t\tthis.$elem = elem;\n\t\tthis.mainMenu = null;\n\t\tthis.textMenu = null;\n\t\t\n\t\tthis.undoArray = [];\n\t\tthis.undoCurrent = -1;\n\t\tthis.undoMax = 10;\n\n\t\tthis.draw = false;\n\n\t\tthis.canvas = null;\n\t\tthis.ctx = null;\n\n\t\tthis.canvasTemp = null;\n\t\tthis.ctxTemp = null;\n\t\t\n\t\tthis.canvasBg = null;\n\t\tthis.ctxBg = null;\n\n\t\tthis.canvasTempLeftOriginal = null;\n\t\tthis.canvasTempTopOriginal = null;\n\t\t\n\t\tthis.canvasTempLeftNew = null;\n\t\tthis.canvasTempTopNew = null;\n\t\t\n\t\tthis.textInput = null;\n\t\t\n\t\treturn this;\n\t}\n\t\n\tCanvas.prototype = \n\t{\t\n\t\t/*******************************************************************************\n\t\t * Generate canvases and events\n\t\t *******************************************************************************/\n\t\tgenerate: function(width, height)\n\t\t{\t\n\t\t\tthis.canvas = document.createElement('canvas');\n\t\t\tthis.ctx = this.canvas.getContext('2d');\n\t\t\t\n\t\t\t//create local reference\n\t\t\tvar _self = this;\n\t\t\t\n\t\t\t$(this.canvas)\n\t\t\t.attr('width', width + 'px')\n\t\t\t.attr('height', height + 'px')\n\t\t\t.css({position: 'absolute', left: 0, top: 0})\n\t\t\t.mousedown(function(e)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_self.draw = true;\n\t\t\t\t_self.callFunc(e, _self, 'Down');\n\t\t\t});\n\t\t\t\n\t\t\t$(document)\n\t\t\t.mousemove(function(e)\n\t\t\t{\n\t\t\t\tif(_self.draw) _self.callFunc(e, _self, 'Move');\n\t\t\t})\n\t\t\t.mouseup(function(e)\n\t\t\t{\n\t\t\t\t//make sure we are in draw mode otherwise this will fire on any mouse up.\n\t\t\t\tif(_self.draw)\n\t\t\t\t{\n\t\t\t\t\t_self.draw = false;\n\t\t\t\t\t_self.callFunc(e, _self, 'Up');\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.bindMobile();\n\n\t\t\treturn $(this.canvas);\n\t\t},\n\n\t\tbindMobile: function()\n\t\t{\n\t\t\t$(this.canvas).bind('touchstart touchmove touchend touchcancel', function ()\n\t\t\t{\n\t\t\t\tvar touches = event.changedTouches, first = touches[0], type = \"\"; \n\n\t\t\t\tswitch (event.type)\n\t\t\t\t{\n\t\t\t\t\tcase \"touchstart\": type = \"mousedown\"; break; \n\t\t\t\t\tcase \"touchmove\": type = \"mousemove\"; break; \n\t\t\t\t\tcase \"touchend\": type = \"mouseup\"; break; \n\t\t\t\t\tdefault: return;\n\t\t\t\t}\n\n\t\t\t\tvar simulatedEvent = document.createEvent(\"MouseEvent\"); \n\n\t\t\t\tsimulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY, false, false, false, false, 0/*left*/, null);\n\t\t\t\tfirst.target.dispatchEvent(simulatedEvent);\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t},\n\t\t\n\t\tgenerateTemp: function()\n\t\t{\n\t\t\tthis.canvasTemp = document.createElement('canvas');\n\t\t\tthis.ctxTemp = this.canvasTemp.getContext('2d');\n\t\t\t\n\t\t\t$(this.canvasTemp).css({position: 'absolute'}).hide();\n\t\t\t\n\t\t\treturn $(this.canvasTemp);\n\t\t},\n\n\t\tgenerateBg: function(width, height, data)\n\t\t{\n\t\t\tvar _self = this;\n\t\t\t\n\t\t\tif(!this.canvasBg)\n\t\t\t{\n\t\t\t\tthis.canvasBg = document.createElement('canvas');\n\t\t\t\tthis.ctxBg = this.canvasBg.getContext('2d');\n\n\t\t\t\t$(this.canvasBg).attr('id', 'mofo').css({position: 'absolute', left: 0, top: 0}).attr('width', width).attr('height', height);\n\t\t\t}\n\t\t\t\t\n\t\t\tthis.setBgImage(data);\n\n\t\t\treturn $(this.canvasBg);\n\t\t},\n\t\t\n\t\tgenerateTextInput: function()\n\t\t{\n\t\t\tvar _self = this;\n\t\t\t\n\t\t\t_self.textCalc = $('<div></div>').css({display:'none', fontSize:this.settings.fontSize, lineHeight:this.settings.fontSize+'px', fontFamily:this.settings.fontFamily});\n\t\t\t\n\t\t\t_self.textInput = \n\t\t\t$('<textarea class=\"_wPaint_textInput\" spellcheck=\"false\"></textarea>')\n\t\t\t.css({display:'none', position:'absolute', color:this.settings.fillStyle, fontSize:this.settings.fontSize, lineHeight:this.settings.fontSize+'px', fontFamily:this.settings.fontFamily})\n\n\t\t\tif(_self.settings.fontTypeBold) { _self.textInput.css('fontWeight', 'bold'); _self.textCalc.css('fontWeight', 'bold'); }\n\t\t\tif(_self.settings.fontTypeItalic) { _self.textInput.css('fontStyle', 'italic'); _self.textCalc.css('fontStyle', 'italic'); }\n\t\t\tif(_self.settings.fontTypeUnderline) { _self.textInput.css('textDecoration', 'underline'); _self.textCalc.css('textDecoration', 'underline'); }\n\t\t\t\n\t\t\t$('body').append(_self.textCalc);\n\t\t\t\n\t\t\treturn _self.textInput;\n\t\t},\n\t\t\n\t\tcallFunc: function(e, _self, event)\n\t\t{\n\t\t\t$e = jQuery.extend(true, {}, e);\n\t\t\t\n\t\t\tvar canvas_offset = $(_self.canvas).offset();\n\t\t\t\n\t\t\t$e.pageX = Math.floor($e.pageX - canvas_offset.left);\n\t\t\t$e.pageY = Math.floor($e.pageY - canvas_offset.top);\n\t\t\t\n\t\t\tvar mode = $.inArray(_self.settings.mode, shapes) > -1 ? 'Shape' : _self.settings.mode;\n\t\t\tvar func = _self['draw' + mode + '' + event];\t\n\t\t\t\n\t\t\tif(func) func($e, _self);\n\n\t\t\tif(_self.settings['draw' + event]) _self.settings['draw' + event].apply(_self, [e, mode]);\n\n\t\t\tif(_self.settings.mode !== 'Text' && event === 'Up') { this.addUndo(); }\n\t\t},\n\t\t\n\t\t/*******************************************************************************\n\t\t * draw any shape\n\t\t *******************************************************************************/\n\t\tdrawShapeDown: function(e, _self)\n\t\t{\n\t\t\tif(_self.settings.mode == 'Text')\n\t\t\t{\n\t\t\t\t//draw current text before resizing next text box\n\t\t\t\tif(_self.textInput.val() != '') _self.drawTextUp(e, _self);\n\t\t\t\t\n\t\t\t\t_self.textInput.css({left: e.pageX-1, top: e.pageY-1, width:0, height:0});\n\t\t\t}\n\n\t\t\t$(_self.canvasTemp)\n\t\t\t.css({left: e.pageX, top: e.pageY})\n\t\t\t.attr('width', 0)\n\t\t\t.attr('height', 0)\n\t\t\t.show();\n\n\t\t\t_self.canvasTempLeftOriginal = e.pageX;\n\t\t\t_self.canvasTempTopOriginal = e.pageY;\n\t\t\t\n\t\t\tvar func = _self['draw' + _self.settings.mode + 'Down'];\n\t\t\t\n\t\t\tif(func) func(e, _self);\n\t\t},\n\t\t\n\t\tdrawShapeMove: function(e, _self)\n\t\t{\n\t\t\tvar xo = _self.canvasTempLeftOriginal;\n\t\t\tvar yo = _self.canvasTempTopOriginal;\n\t\t\t\n\t\t\tvar half_line_width = _self.settings.lineWidth / 2;\n\t\t\t\n\t\t\tvar left = (e.pageX < xo ? e.pageX : xo) - (_self.settings.mode == 'Line' ? Math.floor(half_line_width) : 0);\n\t\t\tvar top = (e.pageY < yo ? e.pageY : yo) - (_self.settings.mode == 'Line' ? Math.floor(half_line_width) : 0);\n\t\t\tvar width = Math.abs(e.pageX - xo) + (_self.settings.mode == 'Line' ? _self.settings.lineWidth : 0);\n\t\t\tvar height = Math.abs(e.pageY - yo) + (_self.settings.mode == 'Line' ? _self.settings.lineWidth : 0);\n\n\t\t\t$(_self.canvasTemp)\n\t\t\t.css({left: left, top: top})\n\t\t\t.attr('width', width)\n\t\t\t.attr('height', height)\n\t\t\t\n\t\t\tif(_self.settings.mode == 'Text') _self.textInput.css({left: left-1, top: top-1, width:width, height:height});\n\t\t\t\n\t\t\t_self.canvasTempLeftNew = left;\n\t\t\t_self.canvasTempTopNew = top;\n\t\t\t\n\t\t\tvar func = _self['draw' + _self.settings.mode + 'Move'];\n\t\t\t\n\t\t\tif(func)\n\t\t\t{\n\t\t\t    var factor = _self.settings.mode == 'Line' ? 1 : 2;\n\t\t\t    \n\t\t\t\te.x = half_line_width*factor;\n\t\t\t\te.y = half_line_width*factor;\n\t\t\t\te.w = width - _self.settings.lineWidth*factor;\n\t\t\t\te.h = height - _self.settings.lineWidth*factor;\n\t\t\t\t\n\t\t\t\t_self.ctxTemp.fillStyle = _self.settings.fillStyle;\n\t\t\t\t_self.ctxTemp.strokeStyle = _self.settings.strokeStyle;\n\t\t\t\t_self.ctxTemp.lineWidth = _self.settings.lineWidth*factor;\n\t\t\t\t\n\t\t\t\tfunc(e, _self);\n\t\t\t}\n\t\t},\n\t\t\n\t\tdrawShapeUp: function(e, _self)\n\t\t{\n\t\t\tif(_self.settings.mode != 'Text')\n\t\t\t{\n\t\t\t\t_self.ctx.drawImage(_self.canvasTemp ,_self.canvasTempLeftNew, _self.canvasTempTopNew);\n\t\t\t\t\n\t\t\t\t$(_self.canvasTemp).hide();\n\t\t\t\t\n\t\t\t\tvar func = _self['draw' + _self.settings.mode + 'Up'];\n\t\t\t\tif(func) func(e, _self);\n\t\t\t}\n\t\t},\n\t\t\n\t\t/*******************************************************************************\n\t\t * draw rectangle\n\t\t *******************************************************************************/\t\t\n\t\tdrawRectangleMove: function(e, _self)\n\t\t{\n\t\t\t_self.ctxTemp.beginPath();\n\t\t\t_self.ctxTemp.rect(e.x, e.y, e.w, e.h)\n\t\t\t_self.ctxTemp.closePath();\n\t\t\t_self.ctxTemp.stroke();\n\t\t\t_self.ctxTemp.fill();\n\t\t},\n\t\t\n\t\t/*******************************************************************************\n\t\t * draw ellipse\n\t\t *******************************************************************************/\n\t\tdrawEllipseMove: function(e, _self)\n\t\t{\n\t\t\tvar kappa = .5522848;\n\t\t\tvar ox = (e.w / 2) * kappa; \t// control point offset horizontal\n\t\t\tvar  oy = (e.h / 2) * kappa; \t// control point offset vertical\n\t\t\tvar  xe = e.x + e.w;           \t// x-end\n\t\t\tvar ye = e.y + e.h;           \t// y-end\n\t\t\tvar xm = e.x + e.w / 2;       \t// x-middle\n\t\t\tvar ym = e.y + e.h / 2;       \t// y-middle\n\t\t\n\t\t\t_self.ctxTemp.beginPath();\n\t\t\t_self.ctxTemp.moveTo(e.x, ym);\n\t\t\t_self.ctxTemp.bezierCurveTo(e.x, ym - oy, xm - ox, e.y, xm, e.y);\n\t\t\t_self.ctxTemp.bezierCurveTo(xm + ox, e.y, xe, ym - oy, xe, ym);\n\t\t\t_self.ctxTemp.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n\t\t\t_self.ctxTemp.bezierCurveTo(xm - ox, ye, e.x, ym + oy, e.x, ym);\n\t\t\t_self.ctxTemp.closePath();\n\t\t\tif(_self.settings.lineWidth > 0)_self.ctxTemp.stroke();\n\t\t\t_self.ctxTemp.fill();\n\t\t},\n\t\t\n\t\t/*******************************************************************************\n\t\t * draw line\n\t\t *******************************************************************************/\t\n\t\tdrawLineMove: function(e, _self)\n\t\t{\t\t\t\t\n\t\t\tvar xo = _self.canvasTempLeftOriginal;\n\t\t\tvar yo = _self.canvasTempTopOriginal;\n\t\t\t\n\t\t\tif(e.pageX < xo) { e.x = e.x + e.w; e.w = e.w * -1}\n\t\t\tif(e.pageY < yo) { e.y = e.y + e.h; e.h = e.h * -1}\n\t\t\t\n\t\t\t_self.ctxTemp.lineJoin = \"round\";\n\t\t\t_self.ctxTemp.beginPath();\n\t\t\t_self.ctxTemp.moveTo(e.x, e.y);\n\t\t\t_self.ctxTemp.lineTo(e.x + e.w, e.y + e.h);\n\t\t\t_self.ctxTemp.closePath();\n\t\t\t_self.ctxTemp.stroke();\n\t\t},\n\t\t\n\t\t/*******************************************************************************\n\t\t * draw pencil\n\t\t *******************************************************************************/\n\t\tdrawPencilDown: function(e, _self)\n\t\t{\n\t\t\t_self.ctx.lineJoin = \"round\";\n\t\t\t_self.ctx.lineCap = \"round\";\n\t\t\t_self.ctx.strokeStyle = _self.settings.strokeStyle;\n\t\t\t_self.ctx.fillStyle = _self.settings.strokeStyle;\n\t\t\t_self.ctx.lineWidth = _self.settings.lineWidth;\n\t\t\t\n\t\t\t//draw single dot in case of a click without a move\n\t\t\t_self.ctx.beginPath();\n\t\t\t_self.ctx.arc(e.pageX, e.pageY, _self.settings.lineWidth/2, 0, Math.PI*2, true);\n\t\t\t_self.ctx.closePath();\n\t\t\t_self.ctx.fill();\n\t\t\t\n\t\t\t//start the path for a drag\n\t\t\t_self.ctx.beginPath();\n\t\t\t_self.ctx.moveTo(e.pageX, e.pageY);\n\t\t},\n\t\t\n\t\tdrawPencilMove: function(e, _self)\n\t\t{\n\t\t\t_self.ctx.lineTo(e.pageX, e.pageY);\n\t\t\t_self.ctx.stroke();\n\t\t},\n\t\t\n\t\tdrawPencilUp: function(e, _self)\n\t\t{\n\t\t\t_self.ctx.closePath();\n\t\t},\n\n\t\t/*******************************************************************************\n\t\t * draw text\n\t\t *******************************************************************************/\n\t\t\n\t\tdrawTextDown: function(e, _self)\n\t\t{\n\t\t\t_self.textInput.val('').show().focus();\n\t\t},\n\t\t\n\t\tdrawTextUp: function(e, _self)\n\t\t{\n\t\t\tif(e) { this.addUndo(); }\n\n\t\t\tvar fontString = '';\n\t\t\tif(_self.settings.fontTypeItalic) fontString += 'italic ';\n\t\t\t//if(_self.settings.fontTypeUnderline) fontString += 'underline ';\n\t\t\tif(_self.settings.fontTypeBold) fontString += 'bold ';\n\t\t\t\n\t\t\tfontString += _self.settings.fontSize + 'px ' + _self.settings.fontFamily;\n\t\t\t\n\t\t\t//setup lines\n\t\t\tvar lines = _self.textInput.val().split('\\n');\n\t\t\tvar linesNew = [];\n\t\t\tvar textInputWidth = _self.textInput.width() - 2;\n\t\t\t\n\t\t\tvar width = 0;\n\t\t\tvar lastj = 0;\n\t\t\t\n\t\t\tfor(var i=0, ii=lines.length; i<ii; i++)\n\t\t\t{\n\t\t\t\t_self.textCalc.html('');\n\t\t\t\tlastj = 0;\n\t\t\t\t\n\t\t\t\tfor(var j=0, jj=lines[0].length; j<jj; j++)\n\t\t\t\t{\n\t\t\t\t\twidth = _self.textCalc.append(lines[i][j]).width();\n\t\t\t\t\t\n\t\t\t\t\tif(width > textInputWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tlinesNew.push(lines[i].substring(lastj,j));\n\t\t\t\t\t\tlastj = j;\n\t\t\t\t\t\t_self.textCalc.html(lines[i][j]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(lastj != j) linesNew.push(lines[i].substring(lastj,j));\n\t\t\t}\n\t\t\t\n\t\t\tlines = _self.textInput.val(linesNew.join('\\n')).val().split('\\n');\n\t\t\t\n\t\t\tvar offset = _self.textInput.position();\n\t\t\tvar left = offset.left;\n\t\t\tvar top = offset.top;\n\t\t\tvar underlineOffset = 0;\n\t\t\t\n\t\t\tfor(var i=0, ii=lines.length; i<ii; i++)\n\t\t\t{\n\t\t\t\t_self.ctx.fillStyle = _self.settings.fillStyle;\n\t\t\t\t\n\t\t\t\t_self.ctx.textBaseline = 'top';\n\t\t\t\t_self.ctx.font = fontString;\n\t\t\t\t_self.ctx.fillText(lines[i], left, top);\n\t\t\t\t\n\t\t\t\ttop += _self.settings.fontSize;\n\t\t\t\t\n\t\t\t\tif(lines[i] != '' && _self.settings.fontTypeUnderline)\n\t\t\t\t{\n\t\t\t\t\twidth = _self.textCalc.html(lines[i]).width();\n\t\t\t\t\t\n\t\t\t\t\t//manually set pixels for underline since to avoid antialiasing 1px issue, and lack of support for underline in canvas\n\t\t\t\t\tvar imgData = _self.ctx.getImageData(0, top+underlineOffset, width, 1);\n\t\t\t\t\t\n\t\t\t\t\tfor (j=0; j<imgData.width*imgData.height*4; j+=4)\n\t\t\t\t\t{\n\t\t\t\t\t\timgData.data[j] = parseInt(_self.settings.fillStyle.substring(1,3), 16);\n\t\t\t\t\t\timgData.data[j+1] = parseInt(_self.settings.fillStyle.substring(3,5), 16);\n\t\t\t\t\t\timgData.data[j+2] = parseInt(_self.settings.fillStyle.substring(5,7), 16);\n\t\t\t\t\t\timgData.data[j+3] = 255;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t_self.ctx.putImageData(imgData, left, top+underlineOffset);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t/*******************************************************************************\n\t\t * eraser\n\t\t *******************************************************************************/\n\t\tdrawEraserDown: function(e, _self)\n\t\t{\n\t\t\t_self.ctx.save();\n\t\t\t_self.ctx.globalCompositeOperation = 'destination-out';\n\t\t\t_self.drawPencilDown(e, _self);\n\t\t},\n\t\t\n\t\tdrawEraserMove: function(e, _self)\n\t\t{\n\t\t    _self.drawPencilMove(e, _self);\n\t\t},\n\t\t\n\t\tdrawEraserUp: function(e, _self)\n\t\t{\n\t\t\t_self.drawPencilUp(e, _self);\n\t\t\t_self.ctx.restore();\n\t\t},\n\n\t\t/*******************************************************************************\n\t\t * save / load data\n\t\t *******************************************************************************/\n\t\tgetImage: function()\n\t\t{\n\t\t\tthis.canvasSave = document.createElement('canvas');\n\t\t\tthis.ctxSave = this.canvasSave.getContext('2d');\n\n\t\t\t$(this.canvasSave).css({display:'none', position: 'absolute', left: 0, top: 0}).attr('width', $(this.canvas).attr('width')).attr('height', $(this.canvas).attr('height'));\n\n\t\t\t//if a bg image is set, it will automatically save with the image\n\t\t\tif(this.canvasBg) this.ctxSave.drawImage(this.canvasBg, 0, 0);\n\n\t\t\tthis.ctxSave.drawImage(this.canvas, 0, 0);\n\n\t\t\treturn this.canvasSave.toDataURL();\n\t\t},\n\t\t\n\t\tsetImage: function(data, addUndo)\n\t\t{\n\t\t\tvar _self = this;\n\t\t\t\n\t\t\tvar myImage = new Image();\n\t\t\tmyImage.src = data.toString();\n\n\t\t\t_self.ctx.clearRect(0, 0, _self.canvas.width, _self.canvas.height);\n\t\t\t\n\t\t\t$(myImage).load(function(){\n\t\t\t\t_self.ctx.drawImage(myImage, 0, 0);\n\t\t\t\tif(addUndo) { _self.addUndo(); }\n\t\t\t});\n\t\t},\n\n\t\tsetBgImage: function(data, addUndo)\n\t\t{\n\t\t\tvar _self = this;\n\n\t\t\tvar myImage = new Image();\n\t\t\tmyImage.src = data.toString();\n\n\t\t\t_self.ctxBg.clearRect(0, 0, _self.canvasBg.width, _self.canvasBg.height);\n\t\t\t\n\t\t\t$(myImage).load(function()\n\t\t\t{\n\t\t\t\t_self.ctxBg.drawImage(myImage, 0, 0);\n\t\t\t});\n\t\t},\n\n\t\t/*******************************************************************************\n\t\t * undo / redo\n\t\t *******************************************************************************/\n\n\t\t addUndo: function()\n\t\t {\n\t\t \t//if it's not at the end of the array we need to repalce the current array position\n\t\t \tif(this.undoCurrent < this.undoArray.length-1)\n\t\t \t{\n\t\t\t\tthis.undoArray[++this.undoCurrent] = this.getImage();\n\t\t \t}\n\t\t \telse // owtherwise we push normally here\n\t\t \t{\n\t\t \t\tthis.undoArray.push(this.getImage());\n\n\t\t \t\t//if we're at the end of the array we need to slice off the front - in increment required\n\t\t \t\tif(this.undoArray.length > this.undoMax){ this.undoArray = this.undoArray.slice(1, this.undoArray.length); }\n\t\t \t\t//if we're NOT at the end of the array, we just increment\n\t\t \t\telse{ this.undoCurrent++; }\n\t\t \t}\n\n\t\t \t//for undo's then a new draw we want to remove everything afterwards - in most cases nothing will happen here\n\t\t \twhile(this.undoCurrent != this.undoArray.length-1) { this.undoArray.pop(); }\n\n\t\t \tthis.undoToggleIcons();\n\t\t },\n\n\t\t setUndoImage: function()\n\t\t {\n\t\t \tthis.setImage(this.undoArray[this.undoCurrent]);\n\t\t },\n\n\t\t undoNext: function()\n\t\t {\n\t\t \tif(this.undoArray[this.undoCurrent+1]) { this.undoCurrent++; this.setUndoImage(); }\n\n\t\t \tthis.undoToggleIcons();\n\t\t },\n\n\t\t undoPrev: function()\n\t\t {\n\t\t \tif(this.undoArray[this.undoCurrent-1]) { this.undoCurrent--; this.setUndoImage(); }\n\n\t\t \tthis.undoToggleIcons();\n\t\t },\n\n\t\t undoToggleIcons: function()\n\t\t {\n\t\t \tvar iconUndo = this.mainMenu.menu.find(\"._wPaint_undo\");\n\t\t\tvar iconRedo = this.mainMenu.menu.find(\"._wPaint_redo\");\n\n\t\t\tif(this.undoCurrent > 0 && this.undoArray.length > 1)\n\t\t\t{\n\t\t\t\t if(!iconUndo.hasClass('uactive')) { iconUndo.addClass('uactive'); }\n\t\t\t}\n\t\t\telse { iconUndo.removeClass('uactive'); }\n\n\t\t\tif(this.undoCurrent < this.undoArray.length-1)\n\t\t\t{\n\t\t\t\tif(!iconRedo.hasClass('uactive')) { iconRedo.addClass('uactive'); }\n\t\t\t}\n\t\t\telse { iconRedo.removeClass('uactive'); }\n\t\t },\n\n\t\t/*******************************************************************************\n\t\t * Functions\n\t\t *******************************************************************************/\n\t\tclearAll: function()\n\t\t{\t\n\t\t\tthis.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n\t\t\tthis.addUndo();\n\t\t}\n\t}\n\t\n\t/**\n\t * Main Menu\n\t */\n\tfunction MainMenu()\n\t{\n\t\tthis.menu = null;\n\t\t\n\t\treturn this;\n\t}\n\t\n\tMainMenu.prototype = \n\t{\n\t\tgenerate: function(canvas, textMenu)\n\t\t{\n\t\t\tvar $canvas = canvas;\n\t\t\tthis.textMenu = textMenu;\n\t\t\tvar _self = this;\n\t\t\t\n\t\t\t//setup the line width select\n\t\t\tvar options = '';\n\t\t\tfor(var i=$canvas.settings.lineWidthMin; i<=$canvas.settings.lineWidthMax; i++) options += '<option value=\"' + i + '\" ' + ($canvas.settings.lineWidth == i ? 'selected=\"selected\"' : '') + '>' + i + '</option>';\n\t\t\t\n\t\t\tvar lineWidth = $('<div class=\"_wPaint_lineWidth _wPaint_dropDown\" title=\"line width\"></div>').append(\n\t\t\t\t$('<select>' + options + '</select>')\n\t\t\t\t.change(function(e){ $canvas.settings.lineWidth = parseInt($(this).val()); })\n\t\t\t)\n\t\t\t\n\t\t\t//content\n\t\t\tvar menuContent = $('<div class=\"_wPaint_options\"></div>');\n\t\t\t\n\t\t\t$.each($canvas.settings.menu, function(i, item)\n\t\t\t{\n\t\t\t\tswitch(item)\n\t\t\t\t{\n\t\t\t\t\tcase 'undo': menuContent.append($('<div class=\"_wPaint_icon _wPaint_undo\" title=\"undo\"></div>').click(function(){ $canvas.undoPrev(); })).append($('<div class=\"_wPaint_icon _wPaint_redo\" title=\"redo\"></div>').click(function(){ $canvas.undoNext(); })); break;\n\t\t\t\t\tcase 'clear': menuContent.append($('<div class=\"_wPaint_icon _wPaint_clear\" title=\"clear\"></div>').click(function(){ $canvas.clearAll(); })); break;\n\t\t\t\t\tcase 'rectangle': menuContent.append($('<div class=\"_wPaint_icon _wPaint_rectangle\" title=\"rectangle\"></div>').click(function(){ _self.set_mode(_self, $canvas, 'Rectangle'); })); break;\n\t\t\t\t\tcase 'ellipse': menuContent.append($('<div class=\"_wPaint_icon _wPaint_ellipse\" title=\"ellipse\"></div>').click(function(){ _self.set_mode(_self, $canvas, 'Ellipse'); })); break;\n\t\t\t\t\tcase 'line': menuContent.append($('<div class=\"_wPaint_icon _wPaint_line\" title=\"line\"></div>').click(function(){ _self.set_mode(_self, $canvas, 'Line'); })); break;\n\t\t\t\t\tcase 'pencil': menuContent.append($('<div class=\"_wPaint_icon _wPaint_pencil\" title=\"pencil\"></div>').click(function(){ _self.set_mode(_self, $canvas, 'Pencil'); })); break;\n\t\t\t\t\tcase 'text': menuContent.append($('<div class=\"_wPaint_icon _wPaint_text\" title=\"text\"></div>').click(function(){ _self.set_mode(_self, $canvas, 'Text'); })); break;\n\t\t\t\t\tcase 'eraser': menuContent.append($('<div class=\"_wPaint_icon _wPaint_eraser\" title=\"eraser\"></div>').click(function(e){ _self.set_mode(_self, $canvas, 'Eraser'); })); break;\n\t\t\t\t\tcase 'fillColor': menuContent.append($('<div class=\"_wPaint_fillColorPicker _wPaint_colorPicker\" title=\"fill color\"></div>')); break;\n\t\t\t\t\tcase 'lineWidth': menuContent.append(lineWidth); break;\n\t\t\t\t\tcase 'strokeColor': menuContent.append($('<div class=\"_wPaint_strokeColorPicker _wPaint_colorPicker\" title=\"stroke color\"></div>')); break;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t//handle\n\t\t\tvar menuHandle = $('<div class=\"_wPaint_handle\"></div>')\n\t\t\t\n\t\t\t//get position of canvas\n\t\t\tvar offset = $($canvas.canvas).offset();\n\t\t\t\n\t\t\t//menu\n\t\t\treturn this.menu = \n\t\t\t$('<div class=\"_wPaint_menu\"></div>')\n\t\t\t.css({position: 'absolute', left: offset.left + $canvas.settings.menuOffsetX, top: offset.top + $canvas.settings.menuOffsetY})\n\t\t\t.draggable({\n\t\t\t\thandle: menuHandle, \n\t\t\t\tdrag: function(){_self.moveTextMenu(_self, _self.textMenu)}, \n\t\t\t\tstop: function(){_self.moveTextMenu(_self, _self.textMenu)}\n\t\t\t})\n\t\t\t.append(menuHandle)\n\t\t\t.append(menuContent);\n\t\t},\n\t\t\n\t\tmoveTextMenu: function(mainMenu, textMenu)\n\t\t{\n\t\t\tif(textMenu.docked)\n\t\t\t{\n\t\t\t\ttextMenu.menu.css({left: parseInt(mainMenu.menu.css('left')) + textMenu.dockOffsetLeft, top: parseInt(mainMenu.menu.css('top')) + textMenu.dockOffsetTop});\n\t\t\t}\n\t\t},\n\t\t\n\t\tset_mode: function(_self, $canvas, mode)\n\t\t{\n\t\t\t$canvas.settings.mode = mode;\n\t\t\t\n\t\t\tif(mode == 'Text') _self.textMenu.menu.show();\n\t\t\telse\n\t\t\t{\n\t\t\t\t$canvas.drawTextUp(null, $canvas);\n\t\t\t\t_self.textMenu.menu.hide();\n\t\t\t\t$canvas.textInput.hide();\n\t\t\t}\n\t\t\t\n\t\t\t_self.menu.find(\"._wPaint_icon\").removeClass('active');\n\t\t\t_self.menu.find(\"._wPaint_\" + mode.toLowerCase()).addClass('active');\n\t\t}\n\t}\n\t\n\t/**\n\t * Text Helper\n\t */\n\tfunction TextMenu()\n\t{\n\t\tthis.menu = null;\n\t\t\n\t\tthis.docked = true;\n\t\t\n\t\tthis.dockOffsetLeft = 0;\n\t\tthis.dockOffsetTop = 36;\n\t\t\n\t\treturn this;\n\t}\n\t\n\tTextMenu.prototype = \n\t{\n\t\tgenerate: function(canvas, mainMenu)\n\t\t{\n\t\t\tvar $canvas = canvas;\n\t\t\tvar _self = this;\n\t\t\t\n\t\t\t//setup font sizes\n\t\t\tvar options = '';\n\t\t\tfor(var i=$canvas.settings.fontSizeMin; i<=$canvas.settings.fontSizeMax; i++) options += '<option value=\"' + i + '\" ' + ($canvas.settings.fontSize == i ? 'selected=\"selected\"' : '') + '>' + i + '</option>';\n\t\t\t\n\t\t\tvar fontSize = $('<div class=\"_wPaint_fontSize _wPaint_dropDown\" title=\"font size\"></div>').append(\n\t\t\t\t$('<select>' + options + '</select>')\n\t\t\t\t.change(function(e){ \n\t\t\t\t\tvar fontSize = parseInt($(this).val());\n\t\t\t\t\t$canvas.settings.fontSize = fontSize;\n\t\t\t\t\t$canvas.textInput.css({fontSize:fontSize, lineHeight:fontSize+'px'});\n\t\t\t\t\t$canvas.textCalc.css({fontSize:fontSize, lineHeight:fontSize+'px'});\n\t\t\t\t})\n\t\t\t)\n\t\t\t\n\t\t\t//setup font family\n\t\t\tvar options = '';\n\t\t\tfor(var i=0, ii=$canvas.settings.fontFamilyOptions.length; i<ii; i++) options += '<option value=\"' + $canvas.settings.fontFamilyOptions[i] + '\" ' + ($canvas.settings.fontFamily == $canvas.settings.fontFamilyOptions[i] ? 'selected=\"selected\"' : '') + '>' + $canvas.settings.fontFamilyOptions[i] + '</option>';\n\t\t\t\n\t\t\tvar fontFamily = $('<div class=\"_wPaint_fontFamily _wPaint_dropDown\" title=\"font family\"></div>').append(\n\t\t\t\t$('<select>' + options + '</select>')\n\t\t\t\t.change(function(e){ \n\t\t\t\t\tvar fontFamily = $(this).val();\n\t\t\t\t\t$canvas.settings.fontFamily = fontFamily;\n\t\t\t\t\t$canvas.textInput.css({fontFamily: fontFamily});\n\t\t\t\t\t$canvas.textCalc.css({fontFamily: fontFamily});\n\t\t\t\t})\n\t\t\t)\n\t\t\t\n\t\t\t//content\n\t\t\tvar menuContent = \n\t\t\t$('<div class=\"_wPaint_options\"></div>')\n\t\t\t.append($('<div class=\"_wPaint_icon _wPaint_bold ' + ($canvas.settings.fontTypeBold ? 'active' : '') + '\" title=\"bold\"></div>').click(function(){ _self.setType(_self, $canvas, 'Bold'); }))\n\t\t\t.append($('<div class=\"_wPaint_icon _wPaint_italic ' + ($canvas.settings.fontTypeItalic ? 'active' : '') + '\" title=\"italic\"></div>').click(function(){ _self.setType(_self, $canvas, 'Italic'); }))\n\t\t\t.append($('<div class=\"_wPaint_icon _wPaint_underline ' + ($canvas.settings.fontTypeUnderline ? 'active' : '') + '\" title=\"underline\"></div>').click(function(){ _self.setType(_self, $canvas, 'Underline'); }))\n\t\t\t.append(fontSize)\n\t\t\t.append(fontFamily)\n\t\t\t\n\t\t\t//handle\n\t\t\tvar menuHandle = $('<div class=\"_wPaint_handle\"></div>')\n\t\t\t\n\t\t\t//get position of canvas\n\t\t\tvar offset = $($canvas.canvas).offset();\n\t\t\t\n\t\t\t//menu\n\t\t\treturn this.menu = \n\t\t\t$('<div class=\"_wPaint_menu\"></div>')\n\t\t\t.css({display: 'none', position: 'absolute'})\n\t\t\t.draggable({\n\t\t\t\tsnap: '._wPaint_menu', \n\t\t\t\thandle: menuHandle,\n\t\t\t\tstop: function(){\n\t\t\t\t\t$.each($(this).data('draggable').snapElements, function(index, element){\n\t\t\t\t\t\t_self.dockOffsetLeft = _self.menu.offset().left - mainMenu.menu.offset().left;\n\t\t\t\t\t\t_self.dockOffsetTop = _self.menu.offset().top - mainMenu.menu.offset().top;\n\t\t\t\t\t\t_self.docked = element.snapping;\n\t\t\t\t\t}); \n\t\t\t\t}\n\t\t\t})\n\t\t\t.append(menuHandle)\n\t\t\t.append(menuContent);\n\t\t},\n\t\t\n\t\tsetType: function(_self, $canvas, mode)\n\t\t{\n\t\t\tvar element = _self.menu.find(\"._wPaint_\" + mode.toLowerCase());\n\t\t\tvar isActive = element.hasClass('active')\n\t\t\t\n\t\t\t$canvas.settings['fontType' + mode] = !isActive;\n\t\t\t\n\t\t\tisActive ? element.removeClass('active') : element.addClass('active');\n\t\t\t\n\t\t\tfontTypeBold = $canvas.settings.fontTypeBold ? 'bold' : 'normal';\n\t\t\tfontTypeItalic = $canvas.settings.fontTypeItalic ? 'italic' : 'normal';\n\t\t\tfontTypeUnderline = $canvas.settings.fontTypeUnderline ? 'underline' : 'none';\n\t\t\t\n\t\t\t$canvas.textInput.css({fontWeight: fontTypeBold}); $canvas.textCalc.css({fontWeight: fontTypeBold});\n\t\t\t$canvas.textInput.css({fontStyle: fontTypeItalic}); $canvas.textCalc.css({fontStyle: fontTypeItalic});\n\t\t\t$canvas.textInput.css({textDecoration: fontTypeUnderline}); $canvas.textCalc.css({textDecoration: fontTypeUnderline});\n\t\t}\n\t}\n})(jQuery);"]}